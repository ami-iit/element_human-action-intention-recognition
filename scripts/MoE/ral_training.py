import os
import numpy as np
from pandas import DataFrame
from pandas import Grouper
from matplotlib import pyplot as plt
from pandas import concat


samples=10

loss = [0]*samples
val_loss =[0]*samples
gate_output_loss =[0]*samples
val_gate_output_loss =[0]*samples
moe_output_loss =[0]*samples
val_moe_output_loss =[0]*samples
gate_output_accuracy =[0]*samples
val_gate_output_accuracy =[0]*samples
moe_output_mae =[0]*samples
val_moe_output_mae =[0]*samples


####################################
#################################### 1
####################################
# Epoch 00036: LearningRateScheduler reducing learning rate to 0.0004782969000000001.
# 261/261 [==============================] - 4s 14ms/step - loss: 1.4707 - gate_output_loss: 0.1979 - moe_output_loss: 0.3341 - gate_output_accuracy: 0.9305 - moe_output_mae: 0.3946 - val_loss: 1.4976 - val_gate_output_loss: 0.2641 - val_moe_output_loss: 0.4311 - val_gate_output_accuracy: 0.8978 - val_moe_output_mae: 0.4440
# [on_epoch_end] epoch: 35 , loss: 1.448967695236206 , val_loss : 1.4975836277008057
# Epoch 00036: val_loss did not improve from 1.48885
loss[0] = [37.9107666015625, 4.753046035766602, 4.279513835906982, 3.921905994415283, 3.6737561225891113, 3.2726354598999023, 3.101224660873413, 3.165086030960083, 3.072077751159668, 2.989074945449829, 2.690164566040039, 2.6775505542755127, 2.609830856323242, 2.592973232269287, 2.5730793476104736, 2.383106231689453, 2.40327525138855, 2.3625142574310303, 2.2904305458068848, 2.231693983078003, 2.000183582305908, 2.049673557281494, 2.0325591564178467, 1.9864342212677002, 1.9828470945358276, 1.9077765941619873, 1.8049464225769043, 1.7654393911361694, 1.8653708696365356, 1.7244867086410522, 1.6002938747406006, 1.6392852067947388, 1.6532390117645264, 1.5800763368606567, 1.6822071075439453, 1.448967695236206]
val_loss[0] = [4.901750087738037, 4.2658867835998535, 3.7170121669769287, 4.152709484100342, 3.3786537647247314, 3.107400417327881, 3.316215753555298, 3.0736429691314697, 3.267298460006714, 2.745783567428589, 3.0600390434265137, 2.7607614994049072, 2.7348902225494385, 2.664921998977661, 2.7203731536865234, 2.383401870727539, 2.37160587310791, 2.3210744857788086, 2.143646478652954, 2.1560399532318115, 1.9957075119018555, 1.863887071609497, 2.102869987487793, 2.1775665283203125, 1.9062060117721558, 2.0396347045898438, 1.8168021440505981, 1.7455897331237793, 1.7019708156585693, 1.69781494140625, 1.4888513088226318, 1.5873719453811646, 1.5985379219055176, 1.6523637771606445, 1.7200241088867188, 1.4975836277008057]
gate_output_loss[0] = [0.6088994145393372, 0.38608190417289734, 0.34760794043540955, 0.32792094349861145, 0.31898829340934753, 0.3010057806968689, 0.28595370054244995, 0.2950306832790375, 0.29066377878189087, 0.2824115455150604, 0.27555641531944275, 0.2700931429862976, 0.26194503903388977, 0.2672507166862488, 0.26873308420181274, 0.25714626908302307, 0.2588902413845062, 0.2586926519870758, 0.24771659076213837, 0.24930062890052795, 0.2360444813966751, 0.2434501349925995, 0.2413104623556137, 0.23051275312900543, 0.23731370270252228, 0.22902514040470123, 0.22430433332920074, 0.21952903270721436, 0.233220174908638, 0.21554842591285706, 0.2157982736825943, 0.21332597732543945, 0.21836254000663757, 0.21563708782196045, 0.21036870777606964, 0.20383769273757935]
val_gate_output_loss[0] = [0.34172767400741577, 0.23293209075927734, 0.22563986480236053, 0.3623764216899872, 0.24477119743824005, 0.24291057884693146, 0.36214515566825867, 0.2227388471364975, 0.26089224219322205, 0.2750757932662964, 0.2886215150356293, 0.24823254346847534, 0.20884181559085846, 0.2689466178417206, 0.22505497932434082, 0.23324470221996307, 0.21417219936847687, 0.20134729146957397, 0.220413476228714, 0.2373569905757904, 0.18992730975151062, 0.21428881585597992, 0.2222478836774826, 0.27113667130470276, 0.20738016068935394, 0.23299992084503174, 0.20908689498901367, 0.21030683815479279, 0.21385183930397034, 0.2148210108280182, 0.1894931197166443, 0.22127710282802582, 0.22800993919372559, 0.22066810727119446, 0.23934371769428253, 0.2640525996685028]
moe_output_loss[0] = [0.5738832950592041, 0.4790264666080475, 0.4505937099456787, 0.4335782527923584, 0.41859620809555054, 0.4100753664970398, 0.39713165163993835, 0.3974323868751526, 0.3943891227245331, 0.38979145884513855, 0.38547804951667786, 0.3792097270488739, 0.3787890076637268, 0.3761743903160095, 0.37781423330307007, 0.3696358799934387, 0.3693053126335144, 0.3701743483543396, 0.3650285601615906, 0.3635418713092804, 0.356082946062088, 0.358304888010025, 0.35550370812416077, 0.35210880637168884, 0.3529757857322693, 0.34882521629333496, 0.3444395065307617, 0.3447006046772003, 0.3534832000732422, 0.34051963686943054, 0.3390977680683136, 0.3387230336666107, 0.339761346578598, 0.33472567796707153, 0.3435017764568329, 0.33280718326568604]
val_moe_output_loss[0] = [0.8201944231987, 0.6256130337715149, 0.5485917925834656, 0.5638042688369751, 0.5696852803230286, 0.4747107923030853, 0.5539207458496094, 0.5306277275085449, 0.5128024220466614, 0.4917122423648834, 0.48517194390296936, 0.4997413456439972, 0.5268401503562927, 0.45529571175575256, 0.5186190605163574, 0.4286534786224365, 0.44636034965515137, 0.4744848310947418, 0.4510338008403778, 0.43135684728622437, 0.4296914041042328, 0.44169601798057556, 0.45933178067207336, 0.4342164993286133, 0.4292396605014801, 0.4251214861869812, 0.42430588603019714, 0.41161075234413147, 0.42663711309432983, 0.4345836341381073, 0.41801437735557556, 0.4280075132846832, 0.4503994286060333, 0.41732487082481384, 0.42871201038360596, 0.43110111355781555]
gate_output_accuracy[0] = [0.8059753179550171, 0.877942681312561, 0.8862342834472656, 0.889442503452301, 0.8900707364082336, 0.8961755037307739, 0.8993310332298279, 0.8965447545051575, 0.8993549942970276, 0.9047596454620361, 0.90309077501297, 0.9083898663520813, 0.9095887541770935, 0.9060783982276917, 0.9053590893745422, 0.9114494919776917, 0.909277081489563, 0.9105910658836365, 0.9139096140861511, 0.9147632122039795, 0.9203212857246399, 0.9147584438323975, 0.9190600514411926, 0.9187003970146179, 0.917621374130249, 0.9200671315193176, 0.9230211973190308, 0.9238317012786865, 0.9183263182640076, 0.9245702028274536, 0.9247812032699585, 0.9254429936408997, 0.924675703048706, 0.9239515662193298, 0.9272893071174622, 0.9281045198440552]
val_gate_output_accuracy[0] = [0.8738722205162048, 0.9245535135269165, 0.9242826700210571, 0.8717054724693298, 0.9155649542808533, 0.9132458567619324, 0.8799492120742798, 0.9235209226608276, 0.9106221199035645, 0.9071180820465088, 0.8969276547431946, 0.9161574244499207, 0.9266186952590942, 0.9102835655212402, 0.925958514213562, 0.9227761030197144, 0.9249259233474731, 0.9266356229782104, 0.9209141135215759, 0.9126703143119812, 0.9339991807937622, 0.9251290559768677, 0.925552248954773, 0.918273389339447, 0.9228607416152954, 0.9194075465202332, 0.9330343008041382, 0.9297503232955933, 0.9246889352798462, 0.9247058629989624, 0.9331697225570679, 0.9249428510665894, 0.9173254370689392, 0.9227930307388306, 0.9151756167411804, 0.8978078961372375]
moe_output_mae[0] = [0.5283156633377075, 0.4776441156864166, 0.46061500906944275, 0.45082801580429077, 0.4430493116378784, 0.4372040629386902, 0.43128588795661926, 0.43075433373451233, 0.42882031202316284, 0.4260249733924866, 0.4225521981716156, 0.42071664333343506, 0.4189595878124237, 0.4171735644340515, 0.4181159436702728, 0.41377636790275574, 0.4144098460674286, 0.41320621967315674, 0.4110809564590454, 0.41012269258499146, 0.4056966006755829, 0.4081006348133087, 0.40541574358940125, 0.4047287106513977, 0.4049008786678314, 0.4015616476535797, 0.39984384179115295, 0.4004947245121002, 0.40234267711639404, 0.3984030783176422, 0.39592352509498596, 0.3962704837322235, 0.39654451608657837, 0.39397841691970825, 0.39707210659980774, 0.39376479387283325]
val_moe_output_mae[0] = [0.6783374547958374, 0.5718190670013428, 0.521709680557251, 0.5306531190872192, 0.524161696434021, 0.47235116362571716, 0.5200274586677551, 0.4870093762874603, 0.4888310730457306, 0.47902488708496094, 0.4755575656890869, 0.4792773127555847, 0.4958743453025818, 0.45736274123191833, 0.48718327283859253, 0.44191211462020874, 0.4559638798236847, 0.4719361960887909, 0.45721349120140076, 0.44371145963668823, 0.4430523216724396, 0.45238497853279114, 0.4569839835166931, 0.4415694773197174, 0.44085443019866943, 0.4404957890510559, 0.436480849981308, 0.4298967719078064, 0.43962234258651733, 0.44290393590927124, 0.4357745945453644, 0.4433930516242981, 0.4598926603794098, 0.43378886580467224, 0.4413708746433258, 0.4439582824707031]
# 74/74 [==============================] - 1s 8ms/step - loss: 1.4976 - gate_output_loss: 0.2641 - moe_output_loss: 0.4311 - gate_output_accuracy: 0.8978 - moe_output_mae: 0.4440
# no test dataset, generating
# ds: <BatchDataset shapes: (None, None, 148), types: tf.float32>
# type(ds): <class 'tensorflow.python.data.ops.dataset_ops.BatchDataset'>
# type(input_data): <class 'tensorflow.python.framework.ops.Tensor'>, shape: Tensor("Shape:0", shape=(3,), dtype=int32)
# type(experts_labels): <class 'tensorflow.python.framework.ops.Tensor'>, shape: Tensor("Shape_1:0", shape=(3,), dtype=int32)
# type(experts_labels): <class 'tensorflow.python.framework.ops.Tensor'>, shape: Tensor("Shape_2:0", shape=(3,), dtype=int32)
# ==============================
# ======== Test Metrics ========
# ==============================
# =========== MoE ===========
# loss                : 2.2587
# gate_output_loss    : 1.0074
# moe_output_loss     : 0.5199
# gate_output_accuracy: 0.7848
# moe_output_mae      : 0.5132
# ==============================
# Model is saved as: __untrack/models/RAL/2022-02-23_15:52:41/model_MoE.h5
# Model architecture is saved as: __untrack/models/RAL/2022-02-23_15:52:41/model_MoE.png

####################################
#################################### 2
####################################
# Epoch 00056: LearningRateScheduler reducing learning rate to 0.0003138105960900001.
# 261/261 [==============================] - 4s 14ms/step - loss: 0.9912 - gate_output_loss: 0.1796 - moe_output_loss: 0.2934 - gate_output_accuracy: 0.9376 - moe_output_mae: 0.3695 - val_loss: 1.0885 - val_gate_output_loss: 0.2127 - val_moe_output_loss: 0.4279 - val_gate_output_accuracy: 0.9231 - val_moe_output_mae: 0.4313
# [on_epoch_end] epoch: 55 , loss: 0.9521195888519287 , val_loss : 1.0885437726974487
# Epoch 00056: val_loss did not improve from 1.03689
loss[1] = [37.87171173095703, 4.872687816619873, 4.3042826652526855, 3.955307722091675, 3.682392120361328, 3.3792521953582764, 3.2282867431640625, 3.2155637741088867, 3.0374319553375244, 2.999239683151245, 2.697350263595581, 2.6984848976135254, 2.6017065048217773, 2.657193899154663, 2.6326165199279785, 2.3273117542266846, 2.4477782249450684, 2.334506034851074, 2.2922470569610596, 2.20548677444458, 2.163587808609009, 2.111250638961792, 2.0296454429626465, 2.002392292022705, 1.9830877780914307, 1.888697624206543, 1.7934443950653076, 1.7706425189971924, 1.7662115097045898, 1.8159605264663696, 1.617814540863037, 1.644203782081604, 1.6790056228637695, 1.580911636352539, 1.629339337348938, 1.46542227268219, 1.4486452341079712, 1.4205536842346191, 1.414481520652771, 1.4121202230453491, 1.2819565534591675, 1.2844852209091187, 1.3312585353851318, 1.268758773803711, 1.2421369552612305, 1.138350248336792, 1.2207543849945068, 1.1573731899261475, 1.126973271369934, 1.1731507778167725, 1.0489197969436646, 1.0763304233551025, 1.0321177244186401, 1.0571106672286987, 1.0153923034667969, 0.9521195888519287]
val_loss[1] = [4.90349006652832, 4.218684196472168, 4.045893669128418, 3.862774133682251, 3.4658141136169434, 3.2023561000823975, 3.235452175140381, 2.9411087036132812, 2.7264018058776855, 2.8517098426818848, 2.6161105632781982, 2.4432222843170166, 2.7634871006011963, 2.4730119705200195, 2.4757044315338135, 2.241941452026367, 2.1882121562957764, 2.3331480026245117, 2.1632771492004395, 2.2238659858703613, 1.9631315469741821, 1.9688210487365723, 1.81622314453125, 1.8565682172775269, 2.0584752559661865, 1.8372879028320312, 1.8100372552871704, 1.6643983125686646, 1.685956597328186, 1.838553547859192, 1.6813479661941528, 1.6333873271942139, 1.872188925743103, 1.5234700441360474, 1.649162769317627, 1.4380162954330444, 1.3657896518707275, 1.372009038925171, 1.3775954246520996, 1.510764718055725, 1.2512186765670776, 1.3824654817581177, 1.2811923027038574, 1.2706787586212158, 1.1706929206848145, 1.0949344635009766, 1.2263444662094116, 1.199090838432312, 1.3413562774658203, 1.1255221366882324, 1.0368949174880981, 1.1252468824386597, 1.0522555112838745, 1.1016486883163452, 1.1517982482910156, 1.0885437726974487]
gate_output_loss[1] = [0.609398603439331, 0.39393219351768494, 0.3461550176143646, 0.3256683051586151, 0.32116806507110596, 0.3032901883125305, 0.2957605719566345, 0.3006857633590698, 0.2890086770057678, 0.290703147649765, 0.2770260274410248, 0.28165292739868164, 0.27400273084640503, 0.2728486955165863, 0.26962077617645264, 0.25960996747016907, 0.26797735691070557, 0.25436314940452576, 0.2511868476867676, 0.24388821423053741, 0.25198134779930115, 0.24049369990825653, 0.22966530919075012, 0.23893652856349945, 0.23299597203731537, 0.23184475302696228, 0.2292383313179016, 0.22365957498550415, 0.22767792642116547, 0.2234717309474945, 0.213721364736557, 0.21174712479114532, 0.21922537684440613, 0.21305085718631744, 0.22012276947498322, 0.21364080905914307, 0.202885702252388, 0.21013948321342468, 0.1978829801082611, 0.2048400342464447, 0.19914932548999786, 0.19248855113983154, 0.20140212774276733, 0.1929589956998825, 0.19017250835895538, 0.186534121632576, 0.19270209968090057, 0.18472221493721008, 0.18277662992477417, 0.1873936504125595, 0.18096210062503815, 0.18167223036289215, 0.17901787161827087, 0.17617648839950562, 0.17630083858966827, 0.17281997203826904]
val_gate_output_loss[1] = [0.32941558957099915, 0.2496318519115448, 0.28418388962745667, 0.24522440135478973, 0.2706869840621948, 0.2901855707168579, 0.2573016285896301, 0.21261166036128998, 0.23940908908843994, 0.24502988159656525, 0.1961948126554489, 0.22101840376853943, 0.23784266412258148, 0.22167320549488068, 0.2172682136297226, 0.25650903582572937, 0.2073526829481125, 0.2565633952617645, 0.22075419127941132, 0.21492034196853638, 0.22734320163726807, 0.21731281280517578, 0.23876647651195526, 0.2021675705909729, 0.19667808711528778, 0.19896721839904785, 0.2200959026813507, 0.21119458973407745, 0.2215084433555603, 0.22949081659317017, 0.24817363917827606, 0.2088087499141693, 0.18834884464740753, 0.22060225903987885, 0.21152237057685852, 0.17724746465682983, 0.21951211988925934, 0.23695576190948486, 0.2226967215538025, 0.2172706425189972, 0.22619663178920746, 0.21841010451316833, 0.20063231885433197, 0.22782036662101746, 0.20045192539691925, 0.18985246121883392, 0.2035428285598755, 0.23981939256191254, 0.22471612691879272, 0.23248291015625, 0.21479511260986328, 0.2164972871541977, 0.21755938231945038, 0.270009309053421, 0.2230861335992813, 0.21269164979457855]
moe_output_loss[1] = [0.5752573013305664, 0.4857693910598755, 0.4582536816596985, 0.43525460362434387, 0.4184418320655823, 0.40990927815437317, 0.4017549455165863, 0.39538079500198364, 0.3894466459751129, 0.38721132278442383, 0.38139185309410095, 0.37572166323661804, 0.37711411714553833, 0.3751188814640045, 0.37372490763664246, 0.3615587055683136, 0.36688852310180664, 0.3577384054660797, 0.36014029383659363, 0.35547375679016113, 0.3527977168560028, 0.35541945695877075, 0.35047414898872375, 0.3465588092803955, 0.3444727063179016, 0.34316450357437134, 0.33837541937828064, 0.3434520959854126, 0.3385085165500641, 0.3366982042789459, 0.33135634660720825, 0.3379468023777008, 0.3366072475910187, 0.3288688063621521, 0.3328624665737152, 0.3282654881477356, 0.32502231001853943, 0.32425472140312195, 0.32238805294036865, 0.3208675682544708, 0.31759485602378845, 0.31650128960609436, 0.3170391619205475, 0.3167833685874939, 0.31350332498550415, 0.31247633695602417, 0.31319329142570496, 0.3073989450931549, 0.30931344628334045, 0.30763089656829834, 0.30232688784599304, 0.3048703670501709, 0.3030170202255249, 0.30247893929481506, 0.3006603717803955, 0.2962237000465393]
val_moe_output_loss[1] = [0.7975266575813293, 0.6045630574226379, 0.5408929586410522, 0.51857590675354, 0.5186155438423157, 0.48151886463165283, 0.47437432408332825, 0.4870208203792572, 0.483989417552948, 0.4736129343509674, 0.4552338719367981, 0.45233219861984253, 0.46037736535072327, 0.4325089752674103, 0.4505174160003662, 0.4635082483291626, 0.44213810563087463, 0.4322039783000946, 0.43365713953971863, 0.45720481872558594, 0.4375346004962921, 0.4327881932258606, 0.4294925332069397, 0.4325217604637146, 0.4277437627315521, 0.4315551221370697, 0.4252732992172241, 0.45562148094177246, 0.4178336262702942, 0.4151480495929718, 0.41987353563308716, 0.4333217740058899, 0.4329974353313446, 0.43802186846733093, 0.45571044087409973, 0.41101616621017456, 0.42271706461906433, 0.4238604009151459, 0.418878436088562, 0.4344520568847656, 0.4162544906139374, 0.40985435247421265, 0.4265102744102478, 0.4131971001625061, 0.4139617085456848, 0.42882901430130005, 0.4164719879627228, 0.4089209735393524, 0.4292924106121063, 0.4028770923614502, 0.4041326940059662, 0.3955877721309662, 0.4025736153125763, 0.41719457507133484, 0.43020176887512207, 0.4279364049434662]
gate_output_accuracy[1] = [0.8055724501609802, 0.8745474219322205, 0.8846133351325989, 0.8898309469223022, 0.891399085521698, 0.8959405422210693, 0.8975278735160828, 0.8959740996360779, 0.9011293649673462, 0.9020261168479919, 0.9041314125061035, 0.9018343091011047, 0.906059205532074, 0.9075602293014526, 0.9065771698951721, 0.9126483798027039, 0.9052535891532898, 0.9116173386573792, 0.9111042022705078, 0.9152044057846069, 0.9112192988395691, 0.915065348148346, 0.9217120409011841, 0.9175446629524231, 0.9180002212524414, 0.9185709357261658, 0.9208056330680847, 0.9225176572799683, 0.9217983484268188, 0.9222059845924377, 0.9261191487312317, 0.9265939593315125, 0.923937201499939, 0.9251025319099426, 0.9239899516105652, 0.9252751469612122, 0.9282196164131165, 0.9264788627624512, 0.9307661056518555, 0.9285697340965271, 0.9302241802215576, 0.9317156076431274, 0.9294472932815552, 0.9320561289787292, 0.9325452446937561, 0.934765636920929, 0.9333077669143677, 0.9345162510871887, 0.9372065663337708, 0.9331446886062622, 0.9365159869194031, 0.9352787733078003, 0.9371394515037537, 0.9380026459693909, 0.9365496039390564, 0.9389617443084717]
val_gate_output_accuracy[1] = [0.8804570436477661, 0.910808265209198, 0.9077444076538086, 0.9163267016410828, 0.9088954925537109, 0.8973000645637512, 0.9102327823638916, 0.9263647794723511, 0.9178840517997742, 0.9100973606109619, 0.9301396608352661, 0.9115361571311951, 0.9136690497398376, 0.9222175478935242, 0.9263817071914673, 0.9109098315238953, 0.9322048425674438, 0.9130088686943054, 0.9274312257766724, 0.929648756980896, 0.9180194735527039, 0.9279052019119263, 0.913939893245697, 0.9327126741409302, 0.9328650236129761, 0.9303766489028931, 0.9242995977401733, 0.9270080327987671, 0.9216081500053406, 0.9242826700210571, 0.9118408560752869, 0.9252983331680298, 0.9311045408248901, 0.9236732721328735, 0.9255014657974243, 0.9418705105781555, 0.9304105043411255, 0.9147016406059265, 0.9243334531784058, 0.9185442328453064, 0.9223191142082214, 0.9276512861251831, 0.9274650812149048, 0.9179348349571228, 0.9278882741928101, 0.9304105043411255, 0.9288362264633179, 0.9169699549674988, 0.9195260405540466, 0.9195091128349304, 0.9262293577194214, 0.9229623079299927, 0.9229623079299927, 0.9030046463012695, 0.9211341738700867, 0.9231146574020386]
moe_output_mae[1] = [0.5294817090034485, 0.47944480180740356, 0.46362850069999695, 0.45130592584609985, 0.4416995048522949, 0.4363667368888855, 0.43231815099716187, 0.42931032180786133, 0.4260399043560028, 0.423737108707428, 0.41968533396720886, 0.41904181241989136, 0.418381005525589, 0.4164136052131653, 0.4162057042121887, 0.4105598032474518, 0.41307827830314636, 0.4078441560268402, 0.4089057147502899, 0.40673407912254333, 0.4042556583881378, 0.4054415822029114, 0.40334218740463257, 0.4016312062740326, 0.3998025059700012, 0.3984405994415283, 0.39734983444213867, 0.3989067077636719, 0.3971189856529236, 0.3953016996383667, 0.3927946984767914, 0.39434003829956055, 0.3945232033729553, 0.3916129171848297, 0.3927640914916992, 0.3904663622379303, 0.3887833058834076, 0.3880901634693146, 0.3869225084781647, 0.38586023449897766, 0.38420161604881287, 0.38230273127555847, 0.382834255695343, 0.3820563852787018, 0.381137490272522, 0.38089412450790405, 0.38052859902381897, 0.3782323896884918, 0.37919068336486816, 0.3776123821735382, 0.37429386377334595, 0.3755173683166504, 0.37527522444725037, 0.37534070014953613, 0.3743637204170227, 0.3702365458011627]
val_moe_output_mae[1] = [0.6658807396888733, 0.5626370310783386, 0.5158288478851318, 0.49969595670700073, 0.49623924493789673, 0.47778403759002686, 0.4720882177352905, 0.47685006260871887, 0.4771125018596649, 0.46661028265953064, 0.460630863904953, 0.4558519721031189, 0.46101054549217224, 0.45040127635002136, 0.4578368365764618, 0.46469083428382874, 0.45663005113601685, 0.4440273642539978, 0.4460039436817169, 0.4602198600769043, 0.4506300389766693, 0.44787466526031494, 0.4431115984916687, 0.44663968682289124, 0.43909791111946106, 0.4427194893360138, 0.4375423192977905, 0.45317721366882324, 0.43268659710884094, 0.4279061257839203, 0.43486350774765015, 0.44156119227409363, 0.439729779958725, 0.44207626581192017, 0.4474818706512451, 0.42372024059295654, 0.4326205551624298, 0.4352418780326843, 0.4286830425262451, 0.43585705757141113, 0.42510583996772766, 0.4311071038246155, 0.43199726939201355, 0.4258117973804474, 0.42832469940185547, 0.43046677112579346, 0.42596635222435, 0.4230470061302185, 0.43313154578208923, 0.4165274202823639, 0.4154456853866577, 0.4168562889099121, 0.41713374853134155, 0.4258311688899994, 0.437130331993103, 0.43129244446754456]
# 74/74 [==============================] - 1s 8ms/step - loss: 1.0885 - gate_output_loss: 0.2127 - moe_output_loss: 0.4279 - gate_output_accuracy: 0.9231 - moe_output_mae: 0.4313
# no test dataset, generating
# ds: <BatchDataset shapes: (None, None, 148), types: tf.float32>
# type(ds): <class 'tensorflow.python.data.ops.dataset_ops.BatchDataset'>
# type(input_data): <class 'tensorflow.python.framework.ops.Tensor'>, shape: Tensor("Shape:0", shape=(3,), dtype=int32)
# type(experts_labels): <class 'tensorflow.python.framework.ops.Tensor'>, shape: Tensor("Shape_1:0", shape=(3,), dtype=int32)
# type(experts_labels): <class 'tensorflow.python.framework.ops.Tensor'>, shape: Tensor("Shape_2:0", shape=(3,), dtype=int32)
# ==============================
# ======== Test Metrics ========
# ==============================
# =========== MoE ===========
# loss                : 1.9825
# gate_output_loss    : 1.1002
# moe_output_loss     : 0.4602
# gate_output_accuracy: 0.8023
# moe_output_mae      : 0.4810
# ==============================
# Model is saved as: __untrack/models/RAL/2022-02-23_16:09:21/model_MoE.h5
# Model architecture is saved as: __untrack/models/RAL/2022-02-23_16:09:21/model_MoE.png

####################################
#################################### 3
####################################

# Epoch 00038: LearningRateScheduler reducing learning rate to 0.0004782969000000001.
# 261/261 [==============================] - 4s 14ms/step - loss: 1.4393 - gate_output_loss: 0.2025 - moe_output_loss: 0.3204 - gate_output_accuracy: 0.9276 - moe_output_mae: 0.3857 - val_loss: 1.6132 - val_gate_output_loss: 0.2077 - val_moe_output_loss: 0.4033 - val_gate_output_accuracy: 0.9224 - val_moe_output_mae: 0.4280
# [on_epoch_end] epoch: 37 , loss: 1.4479705095291138 , val_loss : 1.6132344007492065
# Epoch 00038: val_loss did not improve from 1.45957
loss[2] = [38.011417388916016, 4.816633224487305, 4.230391025543213, 3.972240924835205, 3.7248144149780273, 3.3176822662353516, 3.2695531845092773, 3.212568521499634, 3.0678277015686035, 3.0517866611480713, 2.7022202014923096, 2.6957895755767822, 2.6465437412261963, 2.63037371635437, 2.674138307571411, 2.4502668380737305, 2.319896697998047, 2.33882999420166, 2.3621115684509277, 2.2681896686553955, 2.087221622467041, 2.112107992172241, 2.1092031002044678, 1.993797779083252, 2.008193016052246, 1.9060758352279663, 1.8423818349838257, 1.7866735458374023, 1.8236061334609985, 1.801813006401062, 1.6331887245178223, 1.659873127937317, 1.6037719249725342, 1.6176990270614624, 1.5709649324417114, 1.548445224761963, 1.4869484901428223, 1.4479705095291138]
val_loss[2] = [5.072115421295166, 4.506909370422363, 3.607830286026001, 4.089181900024414, 3.4355661869049072, 3.0920441150665283, 3.387073040008545, 3.269848585128784, 2.7997329235076904, 2.813023805618286, 2.59498929977417, 2.4677069187164307, 2.52473783493042, 2.5121140480041504, 2.4980993270874023, 2.3294806480407715, 2.4261395931243896, 2.274763584136963, 2.3236634731292725, 2.445486545562744, 2.1378986835479736, 2.0340464115142822, 2.040062427520752, 2.0400304794311523, 2.041623830795288, 1.7865393161773682, 1.8101558685302734, 1.8286504745483398, 1.7708073854446411, 1.7202074527740479, 1.5892993211746216, 1.6476539373397827, 1.4595661163330078, 1.4856775999069214, 1.679437518119812, 1.718468427658081, 1.4834654331207275, 1.6132344007492065]
gate_output_loss[2] = [0.6061899065971375, 0.38449662923812866, 0.3431500494480133, 0.33242708444595337, 0.32096317410469055, 0.3115159869194031, 0.3073860704898834, 0.30093345046043396, 0.28960075974464417, 0.2940171957015991, 0.28007015585899353, 0.2720547616481781, 0.27502167224884033, 0.2698465883731842, 0.2778068780899048, 0.26531898975372314, 0.2548551857471466, 0.2556588649749756, 0.2502520978450775, 0.24992302060127258, 0.23926500976085663, 0.24178586900234222, 0.2362235188484192, 0.23419861495494843, 0.23513776063919067, 0.22634842991828918, 0.22848965227603912, 0.22016869485378265, 0.22108082473278046, 0.2278844267129898, 0.21649637818336487, 0.219828799366951, 0.2070809304714203, 0.21784073114395142, 0.20681393146514893, 0.21235860884189606, 0.20547102391719818, 0.20131328701972961]
val_gate_output_loss[2] = [0.33698391914367676, 0.2510632574558258, 0.2398560792207718, 0.2829183042049408, 0.24537798762321472, 0.2097320556640625, 0.27059686183929443, 0.27290764451026917, 0.22342945635318756, 0.21239793300628662, 0.2419193685054779, 0.22681911289691925, 0.22892995178699493, 0.21403133869171143, 0.2176712602376938, 0.243948295712471, 0.2503370940685272, 0.29239529371261597, 0.23194620013237, 0.21898698806762695, 0.1953805387020111, 0.22376248240470886, 0.27117565274238586, 0.22185558080673218, 0.22663618624210358, 0.20448274910449982, 0.22404251992702484, 0.23343876004219055, 0.22559167444705963, 0.19745241105556488, 0.2288578599691391, 0.20975087583065033, 0.21985779702663422, 0.20988455414772034, 0.21379169821739197, 0.21740929782390594, 0.19077041745185852, 0.207682266831398]
moe_output_loss[2] = [0.5783485770225525, 0.4840082824230194, 0.4472179412841797, 0.4298681616783142, 0.41308119893074036, 0.4009804129600525, 0.3968966007232666, 0.3937240540981293, 0.3843501806259155, 0.3861764073371887, 0.3733372688293457, 0.372469961643219, 0.37037187814712524, 0.3674163222312927, 0.3694703280925751, 0.36121276021003723, 0.3566738963127136, 0.35664236545562744, 0.355279803276062, 0.35558950901031494, 0.3464408814907074, 0.34701433777809143, 0.34536680579185486, 0.3431621193885803, 0.34443777799606323, 0.3359764814376831, 0.33754798769950867, 0.3364759385585785, 0.3337542414665222, 0.33366650342941284, 0.3302541673183441, 0.32884150743484497, 0.32834121584892273, 0.3245537579059601, 0.32255008816719055, 0.3262096047401428, 0.3228028416633606, 0.32145577669143677]
val_moe_output_loss[2] = [0.7996866703033447, 0.5979005098342896, 0.5009783506393433, 0.4881119132041931, 0.47979021072387695, 0.47164973616600037, 0.45840418338775635, 0.4484763443470001, 0.4618990421295166, 0.4374538064002991, 0.4441024363040924, 0.45286324620246887, 0.44212135672569275, 0.429999977350235, 0.4684044122695923, 0.43979212641716003, 0.4377768933773041, 0.4441404640674591, 0.42256054282188416, 0.42698633670806885, 0.41199633479118347, 0.4181124269962311, 0.4487338364124298, 0.41700196266174316, 0.4186739921569824, 0.4066128134727478, 0.4068385660648346, 0.40386709570884705, 0.41573604941368103, 0.4093465805053711, 0.4156050980091095, 0.3930872976779938, 0.39528489112854004, 0.40253397822380066, 0.404653936624527, 0.3903304934501648, 0.402633935213089, 0.4032737612724304]
gate_output_accuracy[2] = [0.8053662776947021, 0.8762210607528687, 0.8879846334457397, 0.8890876173973083, 0.8909435272216797, 0.8954417705535889, 0.8957391381263733, 0.8946361541748047, 0.9008944034576416, 0.8991152048110962, 0.9051048755645752, 0.9061455726623535, 0.9048123955726624, 0.909085214138031, 0.9073876142501831, 0.9082508087158203, 0.9136602282524109, 0.9108883738517761, 0.9128977060317993, 0.9132094383239746, 0.9176597595214844, 0.9166238903999329, 0.9182208180427551, 0.9202398061752319, 0.9197506308555603, 0.921649694442749, 0.9201198816299438, 0.9267905354499817, 0.9244455099105835, 0.9205898642539978, 0.9253518581390381, 0.923270583152771, 0.9288958311080933, 0.9232034683227539, 0.9266467094421387, 0.9255916476249695, 0.928051769733429, 0.9292219281196594]
val_gate_output_accuracy[2] = [0.8863309621810913, 0.9168514609336853, 0.9151756167411804, 0.8962336182594299, 0.9146677851676941, 0.9251967668533325, 0.8991789817810059, 0.9020228385925293, 0.9259077310562134, 0.9271265268325806, 0.9128226637840271, 0.9217604994773865, 0.9182395339012146, 0.9267710447311401, 0.9208633303642273, 0.9129411578178406, 0.9097418785095215, 0.8973000645637512, 0.922522246837616, 0.9252136945724487, 0.9304105043411255, 0.9292932748794556, 0.8941176533699036, 0.9169530272483826, 0.9163267016410828, 0.9252136945724487, 0.9208633303642273, 0.913296639919281, 0.9222514033317566, 0.9244858026504517, 0.9183072447776794, 0.9310368299484253, 0.9242826700210571, 0.9249597787857056, 0.9198645949363708, 0.920998752117157, 0.9344223737716675, 0.9223529696464539]
moe_output_mae[2] = [0.5296410322189331, 0.4781467318534851, 0.4590555727481842, 0.44950202107429504, 0.44094979763031006, 0.4333209693431854, 0.43101051449775696, 0.42817026376724243, 0.42411041259765625, 0.42289358377456665, 0.4177585244178772, 0.4155600666999817, 0.41468217968940735, 0.41219329833984375, 0.41338247060775757, 0.4092509150505066, 0.40644052624702454, 0.40608274936676025, 0.40575626492500305, 0.4059622883796692, 0.40110740065574646, 0.40046289563179016, 0.39972373843193054, 0.398625910282135, 0.3996529281139374, 0.39444640278816223, 0.3957940936088562, 0.39495548605918884, 0.3932721018791199, 0.3935491442680359, 0.3916548490524292, 0.3897506594657898, 0.38968729972839355, 0.3884966969490051, 0.38732054829597473, 0.38786017894744873, 0.3858281672000885, 0.3853500485420227]
val_moe_output_mae[2] = [0.6670109033584595, 0.5564783215522766, 0.48772260546684265, 0.4817316234111786, 0.4786852300167084, 0.4745793640613556, 0.46449992060661316, 0.45380908250808716, 0.4624825716018677, 0.4504352807998657, 0.4495150148868561, 0.4585355818271637, 0.45120808482170105, 0.44656145572662354, 0.4656534790992737, 0.4479800760746002, 0.44631820917129517, 0.453255295753479, 0.4373367428779602, 0.43864521384239197, 0.4326285123825073, 0.4384286403656006, 0.45374834537506104, 0.43528974056243896, 0.43512800335884094, 0.4281873404979706, 0.42746803164482117, 0.42738887667655945, 0.43736252188682556, 0.4309014678001404, 0.43662527203559875, 0.42070260643959045, 0.4230547547340393, 0.42808908224105835, 0.43106573820114136, 0.4211615025997162, 0.42638227343559265, 0.4279983937740326]
# 74/74 [==============================] - 0s 6ms/step - loss: 1.6132 - gate_output_loss: 0.2077 - moe_output_loss: 0.4033 - gate_output_accuracy: 0.9224 - moe_output_mae: 0.4280
# no test dataset, generating
# ds: <BatchDataset shapes: (None, None, 148), types: tf.float32>
# type(ds): <class 'tensorflow.python.data.ops.dataset_ops.BatchDataset'>
# type(input_data): <class 'tensorflow.python.framework.ops.Tensor'>, shape: Tensor("Shape:0", shape=(3,), dtype=int32)
# type(experts_labels): <class 'tensorflow.python.framework.ops.Tensor'>, shape: Tensor("Shape_1:0", shape=(3,), dtype=int32)
# type(experts_labels): <class 'tensorflow.python.framework.ops.Tensor'>, shape: Tensor("Shape_2:0", shape=(3,), dtype=int32)
# ==============================
# ======== Test Metrics ========
# ==============================
# =========== MoE ===========
# loss                : 2.4907
# gate_output_loss    : 1.0775
# moe_output_loss     : 0.4413
# gate_output_accuracy: 0.7891
# moe_output_mae      : 0.4753
# ==============================
# Model is saved as: __untrack/models/RAL/2022-02-23_16:17:48/model_MoE.h5
# Model architecture is saved as: __untrack/models/RAL/2022-02-23_16:17:48/model_MoE.png

####################################
#################################### 4
####################################

# Epoch 00071: LearningRateScheduler reducing learning rate to 0.0002287679245496101.
# 261/261 [==============================] - 4s 14ms/step - loss: 0.7388 - gate_output_loss: 0.1546 - moe_output_loss: 0.2864 - gate_output_accuracy: 0.9444 - moe_output_mae: 0.3653 - val_loss: 0.8211 - val_gate_output_loss: 0.2636 - val_moe_output_loss: 0.3785 - val_gate_output_accuracy: 0.9048 - val_moe_output_mae: 0.4102
# [on_epoch_end] epoch: 70 , loss: 0.7341939806938171 , val_loss : 0.8211320042610168
# Epoch 00071: val_loss did not improve from 0.79453
loss[3] = [37.9295539855957, 4.7545647621154785, 4.296685218811035, 4.0116095542907715, 3.6611733436584473, 3.3694968223571777, 3.2348272800445557, 3.15518856048584, 3.0821115970611572, 3.029048204421997, 2.813781261444092, 2.748837947845459, 2.6998465061187744, 2.6031594276428223, 2.510617971420288, 2.299847364425659, 2.300374746322632, 2.31105899810791, 2.3077640533447266, 2.259460926055908, 2.0702881813049316, 2.0003645420074463, 2.015331983566284, 2.059113025665283, 1.951835036277771, 1.8795078992843628, 1.820329189300537, 1.8455281257629395, 1.815367341041565, 1.7599453926086426, 1.6259607076644897, 1.6745216846466064, 1.659548044204712, 1.6063686609268188, 1.6279042959213257, 1.447888731956482, 1.3673841953277588, 1.4737613201141357, 1.4395971298217773, 1.385061502456665, 1.3298752307891846, 1.3051286935806274, 1.240186333656311, 1.2504934072494507, 1.2645717859268188, 1.159888505935669, 1.1765990257263184, 1.1207239627838135, 1.1685014963150024, 1.1329926252365112, 1.0890581607818604, 1.0726561546325684, 1.0320175886154175, 1.0539554357528687, 1.0448824167251587, 0.933776319026947, 1.0274362564086914, 0.9824188351631165, 0.9897392392158508, 0.9564331769943237, 0.8609113693237305, 0.8422123193740845, 0.8832710385322571, 0.8809629082679749, 0.9087657928466797, 0.8231132626533508, 0.7794440388679504, 0.8397527933120728, 0.7996919751167297, 0.7945436835289001, 0.7341939806938171]
val_loss[3] = [4.928283214569092, 4.507894039154053, 3.990041732788086, 3.8605692386627197, 3.463351249694824, 2.9778735637664795, 3.237074851989746, 3.1289076805114746, 2.751832962036133, 2.9136834144592285, 2.6911604404449463, 2.6403915882110596, 2.7709226608276367, 2.5368142127990723, 2.418480157852173, 2.371722459793091, 2.7474169731140137, 2.1244800090789795, 2.212613105773926, 2.0237374305725098, 1.9456013441085815, 1.9781237840652466, 2.0086348056793213, 1.870376467704773, 1.9634994268417358, 1.7359756231307983, 1.8344544172286987, 1.7954174280166626, 1.829785943031311, 1.8880720138549805, 1.5862630605697632, 1.6092208623886108, 1.5953141450881958, 1.5673633813858032, 1.6026684045791626, 1.4958711862564087, 1.3901177644729614, 1.4702545404434204, 1.4501456022262573, 1.459293246269226, 1.4361709356307983, 1.3386884927749634, 1.2566211223602295, 1.2245051860809326, 1.2428454160690308, 1.2217873334884644, 1.2782557010650635, 1.1261205673217773, 1.3435815572738647, 1.1208531856536865, 1.197034478187561, 1.1844693422317505, 1.0868582725524902, 1.1365619897842407, 1.0067964792251587, 1.0445983409881592, 1.0387146472930908, 1.1130297183990479, 0.9465579986572266, 1.0210398435592651, 0.9059688448905945, 0.8949798345565796, 0.9734535813331604, 0.933096170425415, 0.937218964099884, 0.794526219367981, 0.9519623517990112, 0.8975340723991394, 0.9391809701919556, 0.8847330808639526, 0.8211320042610168]
gate_output_loss[3] = [0.6185982823371887, 0.3800501227378845, 0.34900814294815063, 0.3331446647644043, 0.3154875636100769, 0.30088526010513306, 0.29863956570625305, 0.29607534408569336, 0.2907488942146301, 0.2850969731807709, 0.27712008357048035, 0.2812037467956543, 0.2706642150878906, 0.2761230170726776, 0.2665766477584839, 0.2558101713657379, 0.25292348861694336, 0.25127238035202026, 0.2536797523498535, 0.24676506221294403, 0.2408541589975357, 0.23878172039985657, 0.23670507967472076, 0.2395438551902771, 0.23060889542102814, 0.23256757855415344, 0.23184840381145477, 0.23016610741615295, 0.22381000220775604, 0.21522048115730286, 0.21664837002754211, 0.21869739890098572, 0.21213005483150482, 0.21305310726165771, 0.22215358912944794, 0.20261624455451965, 0.20038318634033203, 0.2097819596529007, 0.201321080327034, 0.20173536241054535, 0.20185914635658264, 0.19775649905204773, 0.19068901240825653, 0.19148525595664978, 0.19037005305290222, 0.1842609941959381, 0.1868894398212433, 0.1787196695804596, 0.18701285123825073, 0.17846821248531342, 0.18642719089984894, 0.17973215878009796, 0.1778780072927475, 0.17931954562664032, 0.17899133265018463, 0.16792571544647217, 0.18463745713233948, 0.172856405377388, 0.17683617770671844, 0.16851739585399628, 0.1636042445898056, 0.15992522239685059, 0.1653149574995041, 0.16725866496562958, 0.16883817315101624, 0.16326269507408142, 0.15272127091884613, 0.16513831913471222, 0.15767483413219452, 0.15731976926326752, 0.1524622142314911]
val_gate_output_loss[3] = [0.3503527343273163, 0.2520296573638916, 0.2826775312423706, 0.2690950036048889, 0.22771863639354706, 0.2430451214313507, 0.2706534266471863, 0.26744523644447327, 0.2681390345096588, 0.2752971351146698, 0.23685331642627716, 0.19944660365581512, 0.2234124094247818, 0.23273660242557526, 0.2575720548629761, 0.21773511171340942, 0.22866202890872955, 0.23168198764324188, 0.23262399435043335, 0.23310238122940063, 0.2487829327583313, 0.21192510426044464, 0.23847375810146332, 0.18677106499671936, 0.22686532139778137, 0.22761479020118713, 0.22889795899391174, 0.22885876893997192, 0.24065633118152618, 0.258536696434021, 0.21609842777252197, 0.2118121087551117, 0.20143169164657593, 0.19418862462043762, 0.2298859804868698, 0.2256821244955063, 0.21475982666015625, 0.2113533914089203, 0.22023452818393707, 0.2248302698135376, 0.2185027152299881, 0.20811617374420166, 0.22097459435462952, 0.2169683575630188, 0.2320701777935028, 0.24503710865974426, 0.19087935984134674, 0.21037250757217407, 0.24541430175304413, 0.24899505078792572, 0.27435731887817383, 0.24507030844688416, 0.23652257025241852, 0.21212971210479736, 0.2026328295469284, 0.21520546078681946, 0.21886548399925232, 0.25853851437568665, 0.21148885786533356, 0.21484194695949554, 0.2262207716703415, 0.24329455196857452, 0.22232449054718018, 0.23820701241493225, 0.22135847806930542, 0.2030060589313507, 0.24026800692081451, 0.23208671808242798, 0.21936802566051483, 0.24179762601852417, 0.26361748576164246]
moe_output_loss[3] = [0.5745813846588135, 0.4819781184196472, 0.45142585039138794, 0.43866246938705444, 0.4202975928783417, 0.4134007692337036, 0.40836605429649353, 0.40285834670066833, 0.3947853147983551, 0.3953731060028076, 0.3869660794734955, 0.386262446641922, 0.382609486579895, 0.37472084164619446, 0.3718130886554718, 0.3707769513130188, 0.3640512526035309, 0.36536088585853577, 0.36410996317863464, 0.3571152687072754, 0.3556442856788635, 0.34851789474487305, 0.3491288423538208, 0.349345326423645, 0.346351683139801, 0.3447780907154083, 0.34517592191696167, 0.34461739659309387, 0.3389798700809479, 0.33592450618743896, 0.331364244222641, 0.33604738116264343, 0.3344500958919525, 0.32925352454185486, 0.32996752858161926, 0.3256509304046631, 0.3228641152381897, 0.32629454135894775, 0.32189062237739563, 0.3211709260940552, 0.3234941363334656, 0.32247549295425415, 0.3169203996658325, 0.31616342067718506, 0.3151295781135559, 0.3128340542316437, 0.31239041686058044, 0.3094954788684845, 0.31308698654174805, 0.30865123867988586, 0.3097033202648163, 0.31238406896591187, 0.3065286874771118, 0.30738750100135803, 0.30625659227371216, 0.2997586727142334, 0.30390870571136475, 0.304545521736145, 0.305300235748291, 0.30099329352378845, 0.29860132932662964, 0.2945343554019928, 0.30154937505722046, 0.29712072014808655, 0.29866862297058105, 0.29228267073631287, 0.29459792375564575, 0.2942105829715729, 0.2919786870479584, 0.2941848337650299, 0.28972524404525757]
val_moe_output_loss[3] = [0.8190039396286011, 0.6010494828224182, 0.5650008320808411, 0.5502213835716248, 0.5057365298271179, 0.49397629499435425, 0.4877375364303589, 0.462068110704422, 0.49231085181236267, 0.4582129120826721, 0.447287380695343, 0.4583888351917267, 0.47445547580718994, 0.44599366188049316, 0.46388083696365356, 0.4375949501991272, 0.43710869550704956, 0.45099690556526184, 0.4341978132724762, 0.4171227216720581, 0.4277082681655884, 0.41894933581352234, 0.4399819076061249, 0.4153416156768799, 0.42713189125061035, 0.4369020462036133, 0.4224158525466919, 0.40758153796195984, 0.41966360807418823, 0.42227423191070557, 0.40736791491508484, 0.408687949180603, 0.39870208501815796, 0.41493290662765503, 0.3946264684200287, 0.4098952114582062, 0.41044536232948303, 0.40701889991760254, 0.410024493932724, 0.413343608379364, 0.40734341740608215, 0.3877045214176178, 0.40430372953414917, 0.4062682092189789, 0.40134888887405396, 0.39495334029197693, 0.40112096071243286, 0.4016052484512329, 0.40464136004447937, 0.40510159730911255, 0.38978415727615356, 0.3950645923614502, 0.4047222137451172, 0.3856307566165924, 0.3903198540210724, 0.3872431218624115, 0.38667237758636475, 0.40697094798088074, 0.3890437185764313, 0.3929438591003418, 0.39740699529647827, 0.38423123955726624, 0.3953878581523895, 0.40175843238830566, 0.38458916544914246, 0.385535329580307, 0.3876039981842041, 0.3925086557865143, 0.3875105679035187, 0.38774728775024414, 0.3785109221935272]
gate_output_accuracy[3] = [0.798916220664978, 0.8758518099784851, 0.8823977708816528, 0.8858170509338379, 0.8936290740966797, 0.8945354223251343, 0.8961227536201477, 0.8972976803779602, 0.9015705585479736, 0.9017240405082703, 0.9048363566398621, 0.9031770825386047, 0.9065148234367371, 0.9048075675964355, 0.9103608727455139, 0.9121208190917969, 0.9141014218330383, 0.9121783971786499, 0.9128593802452087, 0.9153818488121033, 0.9181345105171204, 0.9171513915061951, 0.9178803563117981, 0.9167965650558472, 0.9195396304130554, 0.9203165173530579, 0.920249342918396, 0.9213619232177734, 0.9219805598258972, 0.924752414226532, 0.925754725933075, 0.9240474700927734, 0.9255245327949524, 0.9255532622337341, 0.9208440184593201, 0.9296007752418518, 0.9294808506965637, 0.9262006878852844, 0.9296966791152954, 0.9286080598831177, 0.9286512136459351, 0.9305694699287415, 0.9341470003128052, 0.9330775737762451, 0.9332742094993591, 0.9340654611587524, 0.9332646131515503, 0.9377436637878418, 0.9343484044075012, 0.9375710487365723, 0.9343867897987366, 0.9360747933387756, 0.9381560683250427, 0.935978889465332, 0.9356000423431396, 0.941824734210968, 0.9351924061775208, 0.9393213987350464, 0.9371298551559448, 0.9401366710662842, 0.9428701400756836, 0.9421076774597168, 0.9405634999275208, 0.9416089057922363, 0.9397146701812744, 0.9416041374206543, 0.9445102214813232, 0.941292405128479, 0.9443376064300537, 0.9437956809997559, 0.945598840713501]
val_gate_output_accuracy[3] = [0.8696572184562683, 0.9170038104057312, 0.9011425971984863, 0.8988573551177979, 0.920033872127533, 0.9128057360649109, 0.9096403121948242, 0.9033770561218262, 0.9118916392326355, 0.8996191024780273, 0.929885745048523, 0.9318662881851196, 0.9316800832748413, 0.91915363073349, 0.9094202518463135, 0.9229623079299927, 0.9248582124710083, 0.9200000166893005, 0.916022002696991, 0.9133474230766296, 0.9104189872741699, 0.925399899482727, 0.9150401949882507, 0.9330343008041382, 0.9233177900314331, 0.9232839345932007, 0.9168006777763367, 0.9194414019584656, 0.9115530848503113, 0.9140414595603943, 0.9280914068222046, 0.9296149015426636, 0.929885745048523, 0.9271265268325806, 0.9098434448242188, 0.9169191718101501, 0.91915363073349, 0.9225561022758484, 0.9236394166946411, 0.9248243570327759, 0.9239102602005005, 0.9292424917221069, 0.9193229079246521, 0.9216758608818054, 0.9182395339012146, 0.9151079058647156, 0.9325772523880005, 0.9234870672225952, 0.9136013388633728, 0.910588264465332, 0.900550127029419, 0.9062716960906982, 0.9161912798881531, 0.9227930307388306, 0.9245365858078003, 0.9199323058128357, 0.9236394166946411, 0.9045450687408447, 0.9230300188064575, 0.9254845380783081, 0.916986882686615, 0.9142107367515564, 0.9212526679039001, 0.9166314005851746, 0.9196106791496277, 0.9286669492721558, 0.915378749370575, 0.9191367030143738, 0.9176639914512634, 0.9144477248191833, 0.9047989845275879]
moe_output_mae[3] = [0.5294333100318909, 0.47766804695129395, 0.4607934355735779, 0.45296910405158997, 0.4438265562057495, 0.4385789632797241, 0.4352624714374542, 0.4326005280017853, 0.4289778769016266, 0.42855948209762573, 0.42393219470977783, 0.4233759343624115, 0.42083293199539185, 0.41808971762657166, 0.41586169600486755, 0.4142378866672516, 0.4112806022167206, 0.41118869185447693, 0.4110739231109619, 0.4075344204902649, 0.4067602753639221, 0.4028854966163635, 0.4029480814933777, 0.4033738076686859, 0.4005436599254608, 0.39978522062301636, 0.39975807070732117, 0.39864659309387207, 0.3964736759662628, 0.39536252617836, 0.3918553292751312, 0.39493483304977417, 0.39359939098358154, 0.39136531949043274, 0.39188510179519653, 0.3886531889438629, 0.38706791400909424, 0.388310045003891, 0.38735494017601013, 0.3863345980644226, 0.3870413899421692, 0.38528281450271606, 0.3838890492916107, 0.383194237947464, 0.3824623227119446, 0.38125213980674744, 0.38069722056388855, 0.37908482551574707, 0.38112229108810425, 0.3786832094192505, 0.3789916932582855, 0.3801781237125397, 0.37692058086395264, 0.3792059123516083, 0.3774643838405609, 0.372935950756073, 0.3763417899608612, 0.37545546889305115, 0.37703830003738403, 0.37359267473220825, 0.3721840977668762, 0.3699988126754761, 0.37401506304740906, 0.3713397979736328, 0.3728615343570709, 0.36847051978111267, 0.37000545859336853, 0.3696576654911041, 0.3683324158191681, 0.37060627341270447, 0.3664964437484741]
val_moe_output_mae[3] = [0.6775307059288025, 0.5602840781211853, 0.5265527367591858, 0.5187650322914124, 0.4961665868759155, 0.48241135478019714, 0.4825183153152466, 0.46618545055389404, 0.48143652081489563, 0.4590931236743927, 0.4553350806236267, 0.460510790348053, 0.47330886125564575, 0.458516925573349, 0.4697883129119873, 0.45035767555236816, 0.4509698450565338, 0.4617796540260315, 0.4532715678215027, 0.43838971853256226, 0.4473089575767517, 0.43919289112091064, 0.4518803358078003, 0.43570777773857117, 0.44316279888153076, 0.4487496316432953, 0.4387197494506836, 0.4318110942840576, 0.44130027294158936, 0.43926841020584106, 0.4291015863418579, 0.42992904782295227, 0.42534932494163513, 0.43399134278297424, 0.42175427079200745, 0.4297691583633423, 0.4322521686553955, 0.4282016456127167, 0.4339393377304077, 0.43477606773376465, 0.4305490553379059, 0.419579416513443, 0.4288550913333893, 0.42934709787368774, 0.42616528272628784, 0.4209587574005127, 0.4250629246234894, 0.42890286445617676, 0.4277007579803467, 0.43076092004776, 0.4194106161594391, 0.4245139956474304, 0.42916008830070496, 0.41783058643341064, 0.4198344051837921, 0.4183805584907532, 0.4172230362892151, 0.42828840017318726, 0.41797953844070435, 0.4214361906051636, 0.42342063784599304, 0.4141572117805481, 0.4232056438922882, 0.4297908842563629, 0.4171537160873413, 0.41857269406318665, 0.41790521144866943, 0.4197689890861511, 0.4156407415866852, 0.4134654402732849, 0.41023412346839905]
# 74/74 [==============================] - 1s 7ms/step - loss: 0.8211 - gate_output_loss: 0.2636 - moe_output_loss: 0.3785 - gate_output_accuracy: 0.9048 - moe_output_mae: 0.4102
# no test dataset, generating
# ds: <BatchDataset shapes: (None, None, 148), types: tf.float32>
# type(ds): <class 'tensorflow.python.data.ops.dataset_ops.BatchDataset'>
# type(input_data): <class 'tensorflow.python.framework.ops.Tensor'>, shape: Tensor("Shape:0", shape=(3,), dtype=int32)
# type(experts_labels): <class 'tensorflow.python.framework.ops.Tensor'>, shape: Tensor("Shape_1:0", shape=(3,), dtype=int32)
# type(experts_labels): <class 'tensorflow.python.framework.ops.Tensor'>, shape: Tensor("Shape_2:0", shape=(3,), dtype=int32)
# ==============================
# ======== Test Metrics ========
# ==============================
# =========== MoE ===========
# loss                : 1.7770
# gate_output_loss    : 1.2113
# moe_output_loss     : 0.4195
# gate_output_accuracy: 0.7728
# moe_output_mae      : 0.4627
# ==============================
# Model is saved as: __untrack/models/RAL/2022-02-23_16:24:59/model_MoE.h5
# Model architecture is saved as: __untrack/models/RAL/2022-02-23_16:24:59/model_MoE.png


####################################
#################################### 5
####################################

# Epoch 00047: LearningRateScheduler reducing learning rate to 0.0003874204890000001.
# 261/261 [==============================] - 3s 13ms/step - loss: 1.1363 - gate_output_loss: 0.1816 - moe_output_loss: 0.3136 - gate_output_accuracy: 0.9365 - moe_output_mae: 0.3798 - val_loss: 1.2863 - val_gate_output_loss: 0.1942 - val_moe_output_loss: 0.3827 - val_gate_output_accuracy: 0.9303 - val_moe_output_mae: 0.4126
# [on_epoch_end] epoch: 46 , loss: 1.151475191116333 , val_loss : 1.2862509489059448
# Epoch 00047: val_loss did not improve from 1.27089
loss[4] = [38.038021087646484, 4.796234130859375, 4.27998161315918, 3.9255149364471436, 3.722308874130249, 3.324991464614868, 3.199651002883911, 3.1577651500701904, 3.1307730674743652, 3.0607807636260986, 2.846735715866089, 2.7088165283203125, 2.7320210933685303, 2.6545941829681396, 2.5869176387786865, 2.3624074459075928, 2.3259103298187256, 2.4498002529144287, 2.3495242595672607, 2.2776119709014893, 2.112499237060547, 2.072197914123535, 2.052382469177246, 2.0328664779663086, 2.094627857208252, 1.8935856819152832, 1.8327183723449707, 1.8062949180603027, 1.7526021003723145, 1.8166438341140747, 1.6119513511657715, 1.68117094039917, 1.5418177843093872, 1.5893158912658691, 1.5593153238296509, 1.4356393814086914, 1.3954309225082397, 1.4374703168869019, 1.4504808187484741, 1.4276764392852783, 1.3178788423538208, 1.291785717010498, 1.3250327110290527, 1.237938642501831, 1.3385369777679443, 1.1849408149719238, 1.151475191116333]
val_loss[4] = [5.103795528411865, 4.3088908195495605, 3.9264159202575684, 3.855978012084961, 3.768221616744995, 3.241230010986328, 2.97163724899292, 3.0177969932556152, 3.2331013679504395, 2.8107597827911377, 3.067321300506592, 2.52364444732666, 2.6312830448150635, 2.6500813961029053, 2.82551908493042, 2.372469902038574, 2.6345670223236084, 2.3923356533050537, 2.4622409343719482, 2.7228949069976807, 2.056936502456665, 2.4799790382385254, 2.13533878326416, 2.1409342288970947, 1.9093642234802246, 1.7262630462646484, 1.7489008903503418, 1.7670879364013672, 1.881325125694275, 1.694830060005188, 1.6509898900985718, 1.7154786586761475, 1.5160400867462158, 1.6309585571289062, 1.4485608339309692, 1.5805182456970215, 1.5182346105575562, 1.4802086353302002, 1.6338098049163818, 1.3888955116271973, 1.3498241901397705, 1.2792315483093262, 1.3313145637512207, 1.310085654258728, 1.2804536819458008, 1.2708885669708252, 1.2862509489059448]
gate_output_loss[4] = [0.6198787093162537, 0.38714519143104553, 0.34299197793006897, 0.32759889960289, 0.3241191506385803, 0.3040269613265991, 0.298869252204895, 0.30346253514289856, 0.28814834356307983, 0.2917507588863373, 0.278790682554245, 0.27946940064430237, 0.28013041615486145, 0.2697090208530426, 0.26349252462387085, 0.2636013329029083, 0.25600603222846985, 0.2625526785850525, 0.2532329857349396, 0.25003910064697266, 0.24187971651554108, 0.24220165610313416, 0.2396325170993805, 0.23113270103931427, 0.23797467350959778, 0.2378459870815277, 0.22284270823001862, 0.2224283069372177, 0.22399428486824036, 0.22061017155647278, 0.21691399812698364, 0.21888990700244904, 0.2123102992773056, 0.21182487905025482, 0.2110975980758667, 0.2082633674144745, 0.20287427306175232, 0.20327286422252655, 0.20396490395069122, 0.19740088284015656, 0.19661583006381989, 0.1990637183189392, 0.1999855637550354, 0.1870349943637848, 0.2008117437362671, 0.19387702643871307, 0.18156084418296814]
val_gate_output_loss[4] = [0.37229645252227783, 0.291405588388443, 0.2753000855445862, 0.2481769323348999, 0.28901633620262146, 0.23336413502693176, 0.23365680873394012, 0.26830700039863586, 0.2502603530883789, 0.2212122231721878, 0.2770927846431732, 0.2363223433494568, 0.23588186502456665, 0.19880789518356323, 0.29600733518600464, 0.2720550000667572, 0.28329557180404663, 0.19801770150661469, 0.22128920257091522, 0.32599952816963196, 0.22845029830932617, 0.263588547706604, 0.26445889472961426, 0.20897918939590454, 0.2100733518600464, 0.2301303595304489, 0.2415250539779663, 0.22228200733661652, 0.20559357106685638, 0.23645319044589996, 0.22686122357845306, 0.2150082141160965, 0.19185960292816162, 0.2206740379333496, 0.20383383333683014, 0.19300754368305206, 0.20583513379096985, 0.24516251683235168, 0.23399432003498077, 0.20373594760894775, 0.19111540913581848, 0.19754643738269806, 0.25146785378456116, 0.19635924696922302, 0.20205871760845184, 0.22821931540966034, 0.19420260190963745]
moe_output_loss[4] = [0.5792137980461121, 0.47963589429855347, 0.4454140365123749, 0.42847132682800293, 0.41374680399894714, 0.4023199677467346, 0.4008551836013794, 0.3946301341056824, 0.39528799057006836, 0.3865908980369568, 0.38415345549583435, 0.37629786133766174, 0.37997549772262573, 0.37595313787460327, 0.37151044607162476, 0.3635803759098053, 0.36162737011909485, 0.3645014762878418, 0.3570975661277771, 0.35772666335105896, 0.35297879576683044, 0.35057756304740906, 0.3510122001171112, 0.34723079204559326, 0.34282994270324707, 0.3418138027191162, 0.3403407037258148, 0.3407900333404541, 0.33396250009536743, 0.3397132456302643, 0.33084622025489807, 0.3358174264431, 0.3295673727989197, 0.32798412442207336, 0.3301999866962433, 0.323655366897583, 0.3243790864944458, 0.3213500678539276, 0.32511311769485474, 0.32448092103004456, 0.3199092149734497, 0.3190265893936157, 0.3189781606197357, 0.3173028230667114, 0.31731337308883667, 0.3128086030483246, 0.3123931288719177]
val_moe_output_loss[4] = [0.81819087266922, 0.5792454481124878, 0.5300189852714539, 0.48015260696411133, 0.4858725965023041, 0.46959587931632996, 0.45666131377220154, 0.4505060315132141, 0.49037110805511475, 0.4288123846054077, 0.44634026288986206, 0.44259151816368103, 0.44681546092033386, 0.44001197814941406, 0.46235719323158264, 0.4283899962902069, 0.4184316396713257, 0.4302670359611511, 0.41568782925605774, 0.4312528371810913, 0.4005013406276703, 0.4257921874523163, 0.4157206118106842, 0.42548927664756775, 0.4058316946029663, 0.39808711409568787, 0.40068528056144714, 0.39680659770965576, 0.3895520865917206, 0.3910273611545563, 0.3868492543697357, 0.39234161376953125, 0.401056170463562, 0.40943780541419983, 0.3876388967037201, 0.3862500488758087, 0.4086002707481384, 0.40349963307380676, 0.4142526686191559, 0.38811978697776794, 0.39510130882263184, 0.38942739367485046, 0.4021570086479187, 0.39643561840057373, 0.39190560579299927, 0.3822881281375885, 0.3827143609523773]
gate_output_accuracy[4] = [0.8022826910018921, 0.8758757710456848, 0.8870590925216675, 0.8881428837776184, 0.8919074535369873, 0.8965303897857666, 0.8986548185348511, 0.8948519229888916, 0.9006689786911011, 0.8996523022651672, 0.9042081236839294, 0.90443354845047, 0.9041697382926941, 0.9069032669067383, 0.9089173674583435, 0.9106917381286621, 0.909416139125824, 0.9085529446601868, 0.9108116626739502, 0.9118858575820923, 0.9159908890724182, 0.915070116519928, 0.9175686240196228, 0.9175782203674316, 0.9170458912849426, 0.9152283668518066, 0.9208824038505554, 0.9220908880233765, 0.9224169850349426, 0.9219086170196533, 0.9246900677680969, 0.9250785112380981, 0.9257259368896484, 0.9254717826843262, 0.9263110160827637, 0.9278935194015503, 0.9299460649490356, 0.929653525352478, 0.9277256727218628, 0.9306797981262207, 0.9333269596099854, 0.9298309683799744, 0.9286800026893616, 0.9325740337371826, 0.9304543733596802, 0.9317683577537537, 0.9358494281768799]
val_gate_output_accuracy[4] = [0.8618366718292236, 0.8963690400123596, 0.9041218757629395, 0.9095726013183594, 0.9023613929748535, 0.9212357401847839, 0.9208294749259949, 0.8927972912788391, 0.9081845283508301, 0.9228438138961792, 0.8931527733802795, 0.9136859774589539, 0.9175624251365662, 0.9240964651107788, 0.8946593403816223, 0.900871753692627, 0.8985865712165833, 0.9224037528038025, 0.9233516454696655, 0.8808633089065552, 0.9156834483146667, 0.91209477186203, 0.910588264465332, 0.919796884059906, 0.9253321886062622, 0.9105713367462158, 0.9158527255058289, 0.9259923696517944, 0.9258400201797485, 0.9137875437736511, 0.9195768237113953, 0.9233177900314331, 0.9302750825881958, 0.9211341738700867, 0.9251290559768677, 0.9278713464736938, 0.9233347177505493, 0.9111129641532898, 0.9108421206474304, 0.923385500907898, 0.9249428510665894, 0.9208464026451111, 0.9082691669464111, 0.9285145998001099, 0.9277020692825317, 0.9220144152641296, 0.930292010307312]
moe_output_mae[4] = [0.5309745669364929, 0.4775283634662628, 0.458220511674881, 0.4478440582752228, 0.44015809893608093, 0.433766633272171, 0.4326491951942444, 0.4294764995574951, 0.4281655251979828, 0.42521408200263977, 0.42236679792404175, 0.41870948672294617, 0.41975951194763184, 0.41732701659202576, 0.41501957178115845, 0.41101738810539246, 0.40988650918006897, 0.410674124956131, 0.40787842869758606, 0.40772804617881775, 0.404573917388916, 0.403698593378067, 0.40334251523017883, 0.4006553888320923, 0.3987267315387726, 0.39737045764923096, 0.3964743912220001, 0.39720502495765686, 0.39350584149360657, 0.395815372467041, 0.3910643458366394, 0.3924897313117981, 0.39098381996154785, 0.3902597725391388, 0.39022761583328247, 0.3867172300815582, 0.38733649253845215, 0.38603878021240234, 0.3878421485424042, 0.38654911518096924, 0.3841453790664673, 0.38353946805000305, 0.38364776968955994, 0.38366571068763733, 0.38321271538734436, 0.3804423213005066, 0.37957754731178284]
val_moe_output_mae[4] = [0.6760208606719971, 0.5464091300964355, 0.5065019726753235, 0.4774421155452728, 0.4749562740325928, 0.4685998857021332, 0.4605259895324707, 0.4575765132904053, 0.4827765226364136, 0.4434655010700226, 0.4547381103038788, 0.4500821530818939, 0.455854207277298, 0.4515712857246399, 0.4610699713230133, 0.4399811327457428, 0.43885281682014465, 0.44458481669425964, 0.43549278378486633, 0.44525110721588135, 0.426026314496994, 0.4433153569698334, 0.4385208487510681, 0.4436715841293335, 0.43267959356307983, 0.427558571100235, 0.42567336559295654, 0.4228498935699463, 0.4172694683074951, 0.42257410287857056, 0.41596099734306335, 0.4170379042625427, 0.42705124616622925, 0.42918097972869873, 0.4159225523471832, 0.41492053866386414, 0.43020740151405334, 0.4263226091861725, 0.4296073615550995, 0.4164794087409973, 0.4198939800262451, 0.413960337638855, 0.4248715937137604, 0.4215472340583801, 0.41691896319389343, 0.41265803575515747, 0.4126307964324951]
# 74/74 [==============================] - 0s 6ms/step - loss: 1.2863 - gate_output_loss: 0.1942 - moe_output_loss: 0.3827 - gate_output_accuracy: 0.9303 - moe_output_mae: 0.4126
# no test dataset, generating
# ds: <BatchDataset shapes: (None, None, 148), types: tf.float32>
# type(ds): <class 'tensorflow.python.data.ops.dataset_ops.BatchDataset'>
# type(input_data): <class 'tensorflow.python.framework.ops.Tensor'>, shape: Tensor("Shape:0", shape=(3,), dtype=int32)
# type(experts_labels): <class 'tensorflow.python.framework.ops.Tensor'>, shape: Tensor("Shape_1:0", shape=(3,), dtype=int32)
# type(experts_labels): <class 'tensorflow.python.framework.ops.Tensor'>, shape: Tensor("Shape_2:0", shape=(3,), dtype=int32)
# ==============================
# ======== Test Metrics ========
# ==============================
# =========== MoE ===========
# loss                : 2.0531
# gate_output_loss    : 0.9522
# moe_output_loss     : 0.4271
# gate_output_accuracy: 0.8104
# moe_output_mae      : 0.4635
# ==============================
# Model is saved as: __untrack/models/RAL/2022-02-23_16:32:42/model_MoE.h5
# Model architecture is saved as: __untrack/models/RAL/2022-02-23_16:32:42/model_MoE.png

####################################
#################################### 6
####################################

# Epoch 00053: LearningRateScheduler reducing learning rate to 0.0003486784401000001.
# 261/261 [==============================] - 4s 14ms/step - loss: 1.0294 - gate_output_loss: 0.1709 - moe_output_loss: 0.3011 - gate_output_accuracy: 0.9408 - moe_output_mae: 0.3753 - val_loss: 1.2101 - val_gate_output_loss: 0.2620 - val_moe_output_loss: 0.4167 - val_gate_output_accuracy: 0.9013 - val_moe_output_mae: 0.4338
# [on_epoch_end] epoch: 52 , loss: 1.04456627368927 , val_loss : 1.2100718021392822
# Epoch 00053: val_loss did not improve from 1.12312
loss[5] = [38.007076263427734, 4.653234004974365, 4.290151119232178, 3.98469614982605, 3.814194917678833, 3.3358609676361084, 3.2248594760894775, 3.14481782913208, 3.1722412109375, 3.0344126224517822, 2.8205533027648926, 2.7290146350860596, 2.6445870399475098, 2.6739940643310547, 2.6116645336151123, 2.361013650894165, 2.4212231636047363, 2.3051979541778564, 2.267153739929199, 2.2158210277557373, 2.0973262786865234, 2.021498918533325, 2.032611846923828, 1.944420576095581, 2.0049357414245605, 1.8773618936538696, 1.8956156969070435, 1.766128420829773, 1.762080192565918, 1.8480606079101562, 1.589657187461853, 1.6016592979431152, 1.5937182903289795, 1.602831482887268, 1.6227182149887085, 1.521715521812439, 1.4374037981033325, 1.4559394121170044, 1.4016129970550537, 1.41341233253479, 1.3104289770126343, 1.285750389099121, 1.2767884731292725, 1.2495378255844116, 1.2750838994979858, 1.1589056253433228, 1.1441993713378906, 1.1771342754364014, 1.1259838342666626, 1.168647050857544, 1.0707422494888306, 1.0517252683639526, 1.04456627368927]
val_loss[5] = [4.669712066650391, 4.593083381652832, 4.1380181312561035, 3.5902252197265625, 3.749368190765381, 2.7565934658050537, 3.015017509460449, 3.0896904468536377, 2.845466375350952, 3.089043140411377, 2.640653371810913, 2.5855677127838135, 2.4392082691192627, 3.0616555213928223, 2.3796803951263428, 2.39831805229187, 2.405543088912964, 2.365044593811035, 2.1107921600341797, 2.209839344024658, 1.9291419982910156, 1.9844125509262085, 1.9855087995529175, 1.8486099243164062, 1.8717026710510254, 1.8455452919006348, 1.8352469205856323, 1.8075151443481445, 1.8005417585372925, 1.7950427532196045, 1.6951014995574951, 1.552516222000122, 1.6817786693572998, 1.6103780269622803, 1.6260700225830078, 1.3800541162490845, 1.5021907091140747, 1.4585367441177368, 1.3257085084915161, 1.3487114906311035, 1.2483571767807007, 1.255172610282898, 1.308363676071167, 1.2272565364837646, 1.297190546989441, 1.2455780506134033, 1.2664706707000732, 1.12311851978302, 1.2113207578659058, 1.1498894691467285, 1.1715941429138184, 1.1469900608062744, 1.2100718021392822]
gate_output_loss[5] = [0.6187411546707153, 0.3864503800868988, 0.3374824821949005, 0.3315966725349426, 0.3228802978992462, 0.29831773042678833, 0.30243849754333496, 0.2972980737686157, 0.3007364273071289, 0.29258233308792114, 0.284523606300354, 0.2739100754261017, 0.2676180303096771, 0.2765789031982422, 0.27408143877983093, 0.25501134991645813, 0.2598798871040344, 0.25322315096855164, 0.25332942605018616, 0.24898673593997955, 0.23514796793460846, 0.23542971909046173, 0.23939721286296844, 0.23420658707618713, 0.23309186100959778, 0.22561988234519958, 0.23301059007644653, 0.22286880016326904, 0.22773748636245728, 0.22872908413410187, 0.21341228485107422, 0.21530957520008087, 0.21309776604175568, 0.21336792409420013, 0.21707233786582947, 0.2059718370437622, 0.20570319890975952, 0.20738698542118073, 0.20734480023384094, 0.20648732781410217, 0.1959005743265152, 0.19924114644527435, 0.18826308846473694, 0.19406408071517944, 0.1959579437971115, 0.18525435030460358, 0.18607179820537567, 0.18832959234714508, 0.1838737428188324, 0.18981213867664337, 0.18618565797805786, 0.18309156596660614, 0.17678116261959076]
val_gate_output_loss[5] = [0.36624592542648315, 0.2962700426578522, 0.2819979190826416, 0.2385406792163849, 0.21188271045684814, 0.22999149560928345, 0.20593048632144928, 0.2886427938938141, 0.25559908151626587, 0.2526334822177887, 0.2179509848356247, 0.2196488380432129, 0.21087703108787537, 0.24689994752407074, 0.21279893815517426, 0.2308650016784668, 0.23178212344646454, 0.23511230945587158, 0.24920988082885742, 0.22860965132713318, 0.22520951926708221, 0.2183138132095337, 0.19162045419216156, 0.19825033843517303, 0.21320340037345886, 0.2629168927669525, 0.25017860531806946, 0.25474750995635986, 0.19832153618335724, 0.19909103214740753, 0.19989727437496185, 0.21103985607624054, 0.2049034833908081, 0.2207362949848175, 0.22183631360530853, 0.1944713145494461, 0.20639242231845856, 0.23040884733200073, 0.1985112577676773, 0.21614836156368256, 0.2222192883491516, 0.21266376972198486, 0.20839744806289673, 0.21425475180149078, 0.22857609391212463, 0.23902593553066254, 0.24893581867218018, 0.21970272064208984, 0.25929880142211914, 0.1880553662776947, 0.2577172517776489, 0.20805028080940247, 0.2619625926017761]
moe_output_loss[5] = [0.5858246088027954, 0.4781850576400757, 0.45226559042930603, 0.4330684542655945, 0.42517396807670593, 0.4060535728931427, 0.4011989235877991, 0.39214834570884705, 0.3939701318740845, 0.38771116733551025, 0.38515177369117737, 0.37499338388442993, 0.3715052008628845, 0.37147966027259827, 0.37159615755081177, 0.3632202744483948, 0.3614368140697479, 0.35539090633392334, 0.3568950593471527, 0.3527851998806, 0.351105660200119, 0.348985880613327, 0.3464677333831787, 0.34666886925697327, 0.344418466091156, 0.3378402292728424, 0.3431302607059479, 0.33902767300605774, 0.33490192890167236, 0.33926263451576233, 0.3325943946838379, 0.33091211318969727, 0.3292643129825592, 0.3273055851459503, 0.32864466309547424, 0.3291158378124237, 0.3266219198703766, 0.32258278131484985, 0.3209446966648102, 0.3216736614704132, 0.3152603805065155, 0.31634223461151123, 0.3150821030139923, 0.3129991292953491, 0.3117416203022003, 0.30693891644477844, 0.31147295236587524, 0.30732008814811707, 0.3064807653427124, 0.30799010396003723, 0.3030508756637573, 0.3041185736656189, 0.30429384112358093]
val_moe_output_loss[5] = [0.8320090770721436, 0.6047358512878418, 0.5076112747192383, 0.5457953214645386, 0.48813262581825256, 0.46501800417900085, 0.4427664279937744, 0.46672412753105164, 0.4470300078392029, 0.4754088521003723, 0.47971901297569275, 0.4276825487613678, 0.4346298277378082, 0.47862473130226135, 0.43235647678375244, 0.4356139898300171, 0.4423360228538513, 0.4395246207714081, 0.4169788360595703, 0.4284142255783081, 0.43197542428970337, 0.42319464683532715, 0.4200429320335388, 0.41650962829589844, 0.4206961691379547, 0.4334946572780609, 0.4074055552482605, 0.4200142025947571, 0.4075101613998413, 0.4146304130554199, 0.40445271134376526, 0.40108340978622437, 0.40843939781188965, 0.40241312980651855, 0.40327680110931396, 0.39899981021881104, 0.4094482660293579, 0.4050867259502411, 0.39003267884254456, 0.3970421552658081, 0.3926231265068054, 0.38950011134147644, 0.39175257086753845, 0.38803449273109436, 0.4001530110836029, 0.4041270315647125, 0.40507298707962036, 0.3948732614517212, 0.4044662415981293, 0.3850446045398712, 0.4009155333042145, 0.38696232438087463, 0.41674062609672546]
gate_output_accuracy[5] = [0.8029972314834595, 0.8771034479141235, 0.8882628083229065, 0.8886848092079163, 0.889106810092926, 0.8976909518241882, 0.8965975046157837, 0.8953938484191895, 0.8963721394538879, 0.9014266729354858, 0.902956485748291, 0.9056899547576904, 0.9087063670158386, 0.9056611657142639, 0.9058146476745605, 0.9131278991699219, 0.9101306796073914, 0.9124805331230164, 0.9128593802452087, 0.9125716090202332, 0.9187195897102356, 0.9177412986755371, 0.9181297421455383, 0.9189545512199402, 0.9202685356140137, 0.9209975004196167, 0.917755663394928, 0.9212995767593384, 0.9207720756530762, 0.9197986125946045, 0.9255053400993347, 0.9253278970718384, 0.9252511858940125, 0.9257355332374573, 0.9250305891036987, 0.9282244443893433, 0.9284833669662476, 0.9280374050140381, 0.9271262288093567, 0.9273228645324707, 0.9319074153900146, 0.931073009967804, 0.9335331320762634, 0.9315573573112488, 0.9324637055397034, 0.9348471164703369, 0.9344251155853271, 0.9337825179100037, 0.936981201171875, 0.9320992827415466, 0.9329864382743835, 0.9355472922325134, 0.9378491640090942]
val_gate_output_accuracy[5] = [0.8561489582061768, 0.9069488048553467, 0.8888362050056458, 0.9102158546447754, 0.9268556833267212, 0.9321202039718628, 0.9273127317428589, 0.8949640393257141, 0.9130935072898865, 0.9224376082420349, 0.925399899482727, 0.9239271879196167, 0.9245535135269165, 0.9204570651054382, 0.9270926713943481, 0.9172577261924744, 0.9227422475814819, 0.9246381521224976, 0.9147693514823914, 0.9151925444602966, 0.922826886177063, 0.918832004070282, 0.9305459260940552, 0.9306644201278687, 0.9274989366531372, 0.9109606146812439, 0.9087769985198975, 0.9170884490013123, 0.9258908033370972, 0.9343546628952026, 0.9224545359611511, 0.9264663457870483, 0.9225730299949646, 0.921963632106781, 0.9266525506973267, 0.9304612874984741, 0.928768515586853, 0.921083390712738, 0.9326449632644653, 0.9231992959976196, 0.9215742945671082, 0.9288531541824341, 0.9321202039718628, 0.9209479689598083, 0.924435019493103, 0.919475257396698, 0.9169530272483826, 0.9247735738754272, 0.9129919409751892, 0.9303935766220093, 0.9123825430870056, 0.928768515586853, 0.9013288021087646]
moe_output_mae[5] = [0.5330577492713928, 0.4781935214996338, 0.4619118571281433, 0.45121413469314575, 0.4453553259372711, 0.43652695417404175, 0.4339028596878052, 0.4288105368614197, 0.42841100692749023, 0.4241969585418701, 0.4231248199939728, 0.4182133674621582, 0.4166347086429596, 0.4153137505054474, 0.4148971438407898, 0.4112446904182434, 0.40913623571395874, 0.4065796136856079, 0.4065772593021393, 0.4052301049232483, 0.4023996591567993, 0.40222662687301636, 0.40033647418022156, 0.4008775055408478, 0.39912331104278564, 0.3954406976699829, 0.3986004889011383, 0.39705851674079895, 0.39448320865631104, 0.3954942226409912, 0.392035573720932, 0.3912276029586792, 0.3907260298728943, 0.3900298476219177, 0.3896104097366333, 0.38896235823631287, 0.3878685534000397, 0.3875630795955658, 0.38600486516952515, 0.38716429471969604, 0.38195544481277466, 0.38312864303588867, 0.38315024971961975, 0.3813325762748718, 0.380854070186615, 0.37847888469696045, 0.3792416453361511, 0.3783468008041382, 0.37822225689888, 0.3789178431034088, 0.37548959255218506, 0.3759263753890991, 0.3757103383541107]
val_moe_output_mae[5] = [0.6835569143295288, 0.5601712465286255, 0.4930957853794098, 0.5136721134185791, 0.48070773482322693, 0.46939149498939514, 0.4519163966178894, 0.4692230224609375, 0.45596757531166077, 0.48187536001205444, 0.47480884194374084, 0.44288259744644165, 0.44921770691871643, 0.48267820477485657, 0.44961363077163696, 0.45289936661720276, 0.45438429713249207, 0.45163941383361816, 0.435336172580719, 0.4454125761985779, 0.44342565536499023, 0.4425954818725586, 0.44089123606681824, 0.43722909688949585, 0.438461571931839, 0.4468507468700409, 0.43135979771614075, 0.4385676383972168, 0.43151187896728516, 0.4368286728858948, 0.4291362464427948, 0.4252893030643463, 0.42871764302253723, 0.4267938733100891, 0.4297703206539154, 0.42294666171073914, 0.4316297173500061, 0.42649605870246887, 0.4193641245365143, 0.4255106449127197, 0.41949260234832764, 0.4198553264141083, 0.4198581278324127, 0.417530357837677, 0.4256032407283783, 0.4265233874320984, 0.42728567123413086, 0.42030009627342224, 0.4300846457481384, 0.4155447483062744, 0.4265851378440857, 0.4193175137042999, 0.4337681531906128]
# 74/74 [==============================] - 1s 7ms/step - loss: 1.2101 - gate_output_loss: 0.2620 - moe_output_loss: 0.4167 - gate_output_accuracy: 0.9013 - moe_output_mae: 0.4338
# no test dataset, generating
# ds: <BatchDataset shapes: (None, None, 148), types: tf.float32>
# type(ds): <class 'tensorflow.python.data.ops.dataset_ops.BatchDataset'>
# type(input_data): <class 'tensorflow.python.framework.ops.Tensor'>, shape: Tensor("Shape:0", shape=(3,), dtype=int32)
# type(experts_labels): <class 'tensorflow.python.framework.ops.Tensor'>, shape: Tensor("Shape_1:0", shape=(3,), dtype=int32)
# type(experts_labels): <class 'tensorflow.python.framework.ops.Tensor'>, shape: Tensor("Shape_2:0", shape=(3,), dtype=int32)
# ==============================
# ======== Test Metrics ========
# ==============================
# =========== MoE ===========
# loss                : 2.1175
# gate_output_loss    : 1.1482
# moe_output_loss     : 0.5228
# gate_output_accuracy: 0.7343
# moe_output_mae      : 0.5140
# ==============================
# Model is saved as: __untrack/models/RAL/2022-02-23_16:38:24/model_MoE.h5
# Model architecture is saved as: __untrack/models/RAL/2022-02-23_16:38:24/model_MoE.png

#
####################################
#################################### 7
####################################
# Epoch 00059: LearningRateScheduler reducing learning rate to 0.0003138105960900001.
# 261/261 [==============================] - 4s 14ms/step - loss: 0.9772 - gate_output_loss: 0.1733 - moe_output_loss: 0.2937 - gate_output_accuracy: 0.9402 - moe_output_mae: 0.3706 - val_loss: 1.0125 - val_gate_output_loss: 0.2125 - val_moe_output_loss: 0.4196 - val_gate_output_accuracy: 0.9256 - val_moe_output_mae: 0.4183
# [on_epoch_end] epoch: 58 , loss: 0.9562969207763672 , val_loss : 1.0124855041503906
# Epoch 00059: val_loss did not improve from 1.00424
loss[6] = [38.04853057861328, 4.720789909362793, 4.1948161125183105, 3.9228055477142334, 3.787166118621826, 3.283860921859741, 3.1301960945129395, 3.1035139560699463, 3.1198697090148926, 2.9932780265808105, 2.8156986236572266, 2.6660120487213135, 2.6008527278900146, 2.616189479827881, 2.4872887134552, 2.38824725151062, 2.369795322418213, 2.2721917629241943, 2.2945058345794678, 2.257568359375, 2.087862491607666, 2.1420271396636963, 2.0013771057128906, 2.039947271347046, 2.005509376525879, 1.7854639291763306, 1.8280375003814697, 1.7825957536697388, 1.7882087230682373, 1.7692654132843018, 1.7066973447799683, 1.6618239879608154, 1.627801775932312, 1.5804554224014282, 1.5324852466583252, 1.464576244354248, 1.451203465461731, 1.4358083009719849, 1.4239617586135864, 1.411669135093689, 1.3026944398880005, 1.3018229007720947, 1.3012622594833374, 1.2794748544692993, 1.295417070388794, 1.1329951286315918, 1.171094536781311, 1.156633734703064, 1.1611827611923218, 1.1738499402999878, 1.0408127307891846, 1.0528779029846191, 1.073060393333435, 1.0655517578125, 1.0459473133087158, 0.9855238795280457, 0.9538047909736633, 0.9764668345451355, 0.9562969207763672]
val_loss[6] = [5.154192924499512, 4.643989562988281, 3.9333255290985107, 3.9429168701171875, 3.573472738265991, 3.16530704498291, 3.209357976913452, 3.36887788772583, 2.879387617111206, 2.908595561981201, 2.527467966079712, 2.602490186691284, 2.6368329524993896, 2.5767428874969482, 2.5172958374023438, 2.6669986248016357, 2.2413170337677, 2.253049373626709, 2.2861180305480957, 2.3556439876556396, 2.4012553691864014, 2.200075149536133, 2.136249303817749, 1.986296534538269, 1.8663777112960815, 1.8790655136108398, 1.9301369190216064, 1.7344807386398315, 1.6904175281524658, 1.6531271934509277, 1.7368515729904175, 1.6660045385360718, 1.7080028057098389, 1.6078128814697266, 1.4543001651763916, 1.5196521282196045, 1.4014869928359985, 1.4673495292663574, 1.4066715240478516, 1.4117096662521362, 1.3042538166046143, 1.3271167278289795, 1.408576488494873, 1.2695426940917969, 1.3112858533859253, 1.2734318971633911, 1.2456165552139282, 1.131496787071228, 1.1729758977890015, 1.2262331247329712, 1.1040492057800293, 1.2486052513122559, 1.0973280668258667, 1.0042442083358765, 1.1427645683288574, 1.1138179302215576, 1.0357515811920166, 1.0931763648986816, 1.0124855041503906]
gate_output_loss[6] = [0.6240010261535645, 0.38922545313835144, 0.34570300579071045, 0.3270656168460846, 0.3183194100856781, 0.3038100302219391, 0.29386794567108154, 0.2900310158729553, 0.29872027039527893, 0.28961676359176636, 0.28495389223098755, 0.274080365896225, 0.2752460241317749, 0.2778873145580292, 0.263247549533844, 0.26717936992645264, 0.2599027752876282, 0.2527509033679962, 0.2515183389186859, 0.2525874972343445, 0.2379882037639618, 0.2475666105747223, 0.23924241960048676, 0.2344207614660263, 0.23490789532661438, 0.2253589630126953, 0.2318984568119049, 0.2243528962135315, 0.22434400022029877, 0.22129882872104645, 0.22968676686286926, 0.22360175848007202, 0.21889829635620117, 0.2153068631887436, 0.20937120914459229, 0.20816437900066376, 0.20983433723449707, 0.20831924676895142, 0.20440673828125, 0.19978678226470947, 0.19808782637119293, 0.19506144523620605, 0.1988438367843628, 0.19613030552864075, 0.1972336620092392, 0.18267828226089478, 0.18848225474357605, 0.19058769941329956, 0.18683254718780518, 0.18772007524967194, 0.1777895838022232, 0.18015368282794952, 0.17715400457382202, 0.1854572296142578, 0.17702680826187134, 0.17519432306289673, 0.17151375114917755, 0.17706197500228882, 0.17508664727210999]
val_gate_output_loss[6] = [0.34381920099258423, 0.283193975687027, 0.21766914427280426, 0.2577016353607178, 0.27852293848991394, 0.2571190595626831, 0.2323029488325119, 0.2692309617996216, 0.20556239783763885, 0.2281128615140915, 0.238181933760643, 0.2418081909418106, 0.27071020007133484, 0.24101202189922333, 0.2118363380432129, 0.26113077998161316, 0.22197990119457245, 0.24802231788635254, 0.26146000623703003, 0.21414828300476074, 0.25865569710731506, 0.23169384896755219, 0.244825541973114, 0.2132345587015152, 0.23179610073566437, 0.2396739274263382, 0.2165825366973877, 0.22958047688007355, 0.22527460753917694, 0.21652325987815857, 0.22492079436779022, 0.20563571155071259, 0.20226000249385834, 0.22889183461666107, 0.20988494157791138, 0.22479790449142456, 0.2109614461660385, 0.22456094622612, 0.21801598370075226, 0.20821505784988403, 0.22017362713813782, 0.24884115159511566, 0.20032043755054474, 0.2030428946018219, 0.20998495817184448, 0.21842926740646362, 0.19106537103652954, 0.2110021710395813, 0.21002501249313354, 0.2431759238243103, 0.20904019474983215, 0.28852519392967224, 0.21586978435516357, 0.2031482756137848, 0.22014211118221283, 0.224773108959198, 0.24051472544670105, 0.204402893781662, 0.21250508725643158]
moe_output_loss[6] = [0.5837525725364685, 0.4779030680656433, 0.4466255307197571, 0.4301535487174988, 0.424609512090683, 0.39996203780174255, 0.3978370130062103, 0.38879305124282837, 0.39339691400527954, 0.38821062445640564, 0.37892380356788635, 0.376103013753891, 0.3721698522567749, 0.36961254477500916, 0.37089940905570984, 0.360935240983963, 0.3636930584907532, 0.35625460743904114, 0.3543086647987366, 0.3561987280845642, 0.3525151014328003, 0.3509056866168976, 0.3475108742713928, 0.34671998023986816, 0.34511905908584595, 0.3404052257537842, 0.3403666615486145, 0.33818286657333374, 0.3370627164840698, 0.33515095710754395, 0.33647212386131287, 0.3321080207824707, 0.3349703848361969, 0.3298349678516388, 0.3262820243835449, 0.32406553626060486, 0.3249324560165405, 0.32401955127716064, 0.3215239644050598, 0.322355717420578, 0.3183034360408783, 0.3166331946849823, 0.3174363076686859, 0.3157496452331543, 0.3181374669075012, 0.31154075264930725, 0.3106401562690735, 0.30674970149993896, 0.31282058358192444, 0.30904310941696167, 0.3033508062362671, 0.30629733204841614, 0.3045140504837036, 0.301222026348114, 0.3018450438976288, 0.3010839819908142, 0.2976644039154053, 0.297985702753067, 0.29561594128608704]
val_moe_output_loss[6] = [0.8095428347587585, 0.590684711933136, 0.5312533378601074, 0.5158439874649048, 0.4944070875644684, 0.467732310295105, 0.4780505895614624, 0.4570162296295166, 0.44866544008255005, 0.4486463665962219, 0.4410798251628876, 0.4671928882598877, 0.4485132396221161, 0.48608827590942383, 0.5306782126426697, 0.47079208493232727, 0.4696015417575836, 0.45195600390434265, 0.4360004961490631, 0.46173667907714844, 0.4718562960624695, 0.49430954456329346, 0.45536375045776367, 0.4288007318973541, 0.4400733411312103, 0.43435096740722656, 0.4360862076282501, 0.42102494835853577, 0.45094308257102966, 0.4280094802379608, 0.4681209921836853, 0.4087819755077362, 0.4401771128177643, 0.45776939392089844, 0.4133341610431671, 0.4534023106098175, 0.41413477063179016, 0.4305703639984131, 0.4365169405937195, 0.429304838180542, 0.4354751706123352, 0.43743547797203064, 0.41304224729537964, 0.452466756105423, 0.4151248633861542, 0.4308313727378845, 0.44607415795326233, 0.4242492914199829, 0.4389036297798157, 0.4285166263580322, 0.4088144600391388, 0.42351698875427246, 0.46238818764686584, 0.41948437690734863, 0.4110577702522278, 0.4092808961868286, 0.489872545003891, 0.41859617829322815, 0.41961586475372314]
gate_output_accuracy[6] = [0.8022587299346924, 0.875583291053772, 0.8858554363250732, 0.8900707364082336, 0.8880277872085571, 0.8960316777229309, 0.8986020684242249, 0.8999640345573425, 0.893552303314209, 0.9009087681770325, 0.9026735424995422, 0.9060208797454834, 0.9050809144973755, 0.905243992805481, 0.910763680934906, 0.9076657295227051, 0.9114398956298828, 0.9131278991699219, 0.9119194149971008, 0.9132429957389832, 0.9176309704780579, 0.915271520614624, 0.917141854763031, 0.9189737439155579, 0.9175782203674316, 0.9225560426712036, 0.9200671315193176, 0.9214962124824524, 0.9210454225540161, 0.9235678911209106, 0.9197553992271423, 0.921726405620575, 0.9239276051521301, 0.9240906238555908, 0.9265220165252686, 0.9280374050140381, 0.9258266687393188, 0.9275290966033936, 0.928248405456543, 0.9303824305534363, 0.9306702017784119, 0.9312888383865356, 0.9316293001174927, 0.9326891303062439, 0.9314806461334229, 0.9362330436706543, 0.9336434602737427, 0.9337968826293945, 0.934161365032196, 0.934300422668457, 0.936923623085022, 0.9371730089187622, 0.9380649924278259, 0.9335619211196899, 0.9360747933387756, 0.9368277192115784, 0.9403764605522156, 0.937259316444397, 0.938606858253479]
val_gate_output_accuracy[6] = [0.8828269243240356, 0.9031908512115479, 0.9255183935165405, 0.910588264465332, 0.9084384441375732, 0.9082691669464111, 0.9216589331626892, 0.9111637473106384, 0.9289547204971313, 0.9165298342704773, 0.9183241724967957, 0.91642826795578, 0.8984003663063049, 0.9079475402832031, 0.918916642665863, 0.9041049480438232, 0.921642005443573, 0.9272788763046265, 0.8998560905456543, 0.926195502281189, 0.9105205535888672, 0.9204909205436707, 0.9161574244499207, 0.9271773099899292, 0.9160897135734558, 0.9161743521690369, 0.9192551970481873, 0.9150401949882507, 0.9179009795188904, 0.921963632106781, 0.9250274896621704, 0.9301227331161499, 0.929411768913269, 0.922285258769989, 0.9235547780990601, 0.9235209226608276, 0.925552248954773, 0.9178163409233093, 0.9230300188064575, 0.9273465871810913, 0.9265679121017456, 0.9079983234405518, 0.9280575513839722, 0.9270080327987671, 0.9244688749313354, 0.917951762676239, 0.9311553239822388, 0.9206094145774841, 0.93061363697052, 0.9147524237632751, 0.9217943549156189, 0.8969276547431946, 0.9276005029678345, 0.9295641183853149, 0.9212357401847839, 0.9165806174278259, 0.9155141711235046, 0.925552248954773, 0.925636887550354]
moe_output_mae[6] = [0.530727207660675, 0.4777693748474121, 0.4594837725162506, 0.44937461614608765, 0.44465991854667664, 0.43343082070350647, 0.431711345911026, 0.42783308029174805, 0.42792603373527527, 0.4248812198638916, 0.42061713337898254, 0.41887903213500977, 0.4165806770324707, 0.414650559425354, 0.4149189591407776, 0.4087444841861725, 0.41103458404541016, 0.40686047077178955, 0.40639570355415344, 0.40704435110092163, 0.40464603900909424, 0.40417250990867615, 0.40222620964050293, 0.40147730708122253, 0.40054115653038025, 0.3981103003025055, 0.3983628451824188, 0.39650431275367737, 0.39611706137657166, 0.39485421776771545, 0.39495018124580383, 0.3929636776447296, 0.39433547854423523, 0.3908199071884155, 0.39058175683021545, 0.38777071237564087, 0.3882169723510742, 0.38793110847473145, 0.3860567808151245, 0.3873526453971863, 0.3839154541492462, 0.3836876451969147, 0.3847191631793976, 0.3830999732017517, 0.3842398226261139, 0.3807401657104492, 0.3806482255458832, 0.37847796082496643, 0.38118764758110046, 0.37892231345176697, 0.3764744997024536, 0.37743663787841797, 0.3767906725406647, 0.3748147785663605, 0.3749523162841797, 0.3740280568599701, 0.37270301580429077, 0.3730825185775757, 0.372101366519928]
val_moe_output_mae[6] = [0.672380805015564, 0.5525580048561096, 0.512533962726593, 0.502398669719696, 0.48689648509025574, 0.47190847992897034, 0.4762548506259918, 0.4644428789615631, 0.46255922317504883, 0.4522400498390198, 0.45238369703292847, 0.4676779508590698, 0.45338234305381775, 0.46203359961509705, 0.4770285487174988, 0.4608207941055298, 0.45248091220855713, 0.44304439425468445, 0.4417315423488617, 0.4591606855392456, 0.45949044823646545, 0.4565597474575043, 0.44018375873565674, 0.4314787983894348, 0.4366430342197418, 0.4323289096355438, 0.4382272958755493, 0.43154001235961914, 0.43629419803619385, 0.4323998987674713, 0.4371660649776459, 0.42768383026123047, 0.43764549493789673, 0.43165791034698486, 0.4254917800426483, 0.4290318489074707, 0.4206455945968628, 0.42979106307029724, 0.4278205335140228, 0.42362165451049805, 0.42557185888290405, 0.42917710542678833, 0.4193057417869568, 0.4351031184196472, 0.42338502407073975, 0.42432481050491333, 0.42480847239494324, 0.42493948340415955, 0.4261363446712494, 0.4257892370223999, 0.42239463329315186, 0.4312148094177246, 0.42691656947135925, 0.4190782308578491, 0.42302098870277405, 0.4184088110923767, 0.4362598955631256, 0.4215987026691437, 0.4183048605918884]
# 74/74 [==============================] - 0s 6ms/step - loss: 1.0125 - gate_output_loss: 0.2125 - moe_output_loss: 0.4196 - gate_output_accuracy: 0.9256 - moe_output_mae: 0.4183
# no test dataset, generating
# ds: <BatchDataset shapes: (None, None, 148), types: tf.float32>
# type(ds): <class 'tensorflow.python.data.ops.dataset_ops.BatchDataset'>
# type(input_data): <class 'tensorflow.python.framework.ops.Tensor'>, shape: Tensor("Shape:0", shape=(3,), dtype=int32)
# type(experts_labels): <class 'tensorflow.python.framework.ops.Tensor'>, shape: Tensor("Shape_1:0", shape=(3,), dtype=int32)
# type(experts_labels): <class 'tensorflow.python.framework.ops.Tensor'>, shape: Tensor("Shape_2:0", shape=(3,), dtype=int32)
# ==============================
# ======== Test Metrics ========
# ==============================
# =========== MoE ===========
# loss                : 1.9632
# gate_output_loss    : 1.1606
# moe_output_loss     : 0.4327
# gate_output_accuracy: 0.7871
# moe_output_mae      : 0.4658
# ==============================
# Model is saved as: __untrack/models/RAL/2022-02-23_16:44:29/model_MoE.h5
# Model architecture is saved as: __untrack/models/RAL/2022-02-23_16:44:29/model_MoE.png

####################################
#################################### 8
####################################

# Epoch 00026: LearningRateScheduler reducing learning rate to 0.00059049.
# 261/261 [==============================] - 4s 14ms/step - loss: 1.8626 - gate_output_loss: 0.2272 - moe_output_loss: 0.3494 - gate_output_accuracy: 0.9188 - moe_output_mae: 0.4020 - val_loss: 2.0418 - val_gate_output_loss: 0.2064 - val_moe_output_loss: 0.4161 - val_gate_output_accuracy: 0.9250 - val_moe_output_mae: 0.4348
# [on_epoch_end] epoch: 25 , loss: 1.8858774900436401 , val_loss : 2.041809320449829
# Epoch 00026: val_loss did not improve from 1.97722
loss[7] = [37.87070846557617, 4.80865478515625, 4.200458526611328, 3.834408760070801, 3.7331748008728027, 3.3755156993865967, 3.18290376663208, 3.1831955909729004, 3.1327035427093506, 3.012789011001587, 2.8155882358551025, 2.7625982761383057, 2.7020139694213867, 2.6412999629974365, 2.621952533721924, 2.49566388130188, 2.420602798461914, 2.2850959300994873, 2.3200461864471436, 2.3520307540893555, 2.1771998405456543, 2.039079189300537, 2.1161391735076904, 2.017962694168091, 2.0761260986328125, 1.8858774900436401]
val_loss[7] = [5.401401996612549, 4.407376289367676, 4.496959686279297, 3.9637982845306396, 3.6636416912078857, 3.830545425415039, 3.3688745498657227, 3.3435213565826416, 3.0548171997070312, 3.1404266357421875, 2.6175880432128906, 2.61305570602417, 2.873591423034668, 2.5623276233673096, 3.103848457336426, 2.543926239013672, 2.3496956825256348, 2.291823625564575, 2.2809226512908936, 2.3112170696258545, 1.9772201776504517, 2.044391632080078, 2.0635058879852295, 1.9893569946289062, 2.0187532901763916, 2.041809320449829]
gate_output_loss[7] = [0.6030886769294739, 0.3953701853752136, 0.3400499224662781, 0.31786176562309265, 0.31777697801589966, 0.31044989824295044, 0.2966398596763611, 0.3007516860961914, 0.2922040820121765, 0.2949759066104889, 0.2852167785167694, 0.2737840414047241, 0.27391186356544495, 0.2706887722015381, 0.26815086603164673, 0.26918360590934753, 0.2622002959251404, 0.25188490748405457, 0.25851383805274963, 0.24973838031291962, 0.2501559257507324, 0.24259857833385468, 0.2471775859594345, 0.22727999091148376, 0.24228663742542267, 0.2282794713973999]
val_gate_output_loss[7] = [0.35411372780799866, 0.23473434150218964, 0.2740471661090851, 0.2409759908914566, 0.24119365215301514, 0.270608514547348, 0.2509976923465729, 0.23986457288265228, 0.19641868770122528, 0.26278063654899597, 0.20261205732822418, 0.23960056900978088, 0.2128371000289917, 0.23112435638904572, 0.2891249358654022, 0.23783467710018158, 0.24645130336284637, 0.20924042165279388, 0.2237824648618698, 0.20084820687770844, 0.22026696801185608, 0.23392920196056366, 0.20300698280334473, 0.19214195013046265, 0.17898496985435486, 0.2063692808151245]
moe_output_loss[7] = [0.5760197043418884, 0.4829714298248291, 0.4497070014476776, 0.42578351497650146, 0.426553338766098, 0.4126506447792053, 0.4007582664489746, 0.39857059717178345, 0.39218613505363464, 0.3918670415878296, 0.38398289680480957, 0.3829679489135742, 0.3789791464805603, 0.3771798610687256, 0.37631869316101074, 0.37009111046791077, 0.3706432282924652, 0.3679674565792084, 0.3661232888698578, 0.3666639029979706, 0.35958361625671387, 0.3559914529323578, 0.35998642444610596, 0.3623574376106262, 0.3524908721446991, 0.345831960439682]
val_moe_output_loss[7] = [0.8110688924789429, 0.5789111852645874, 0.5576742887496948, 0.5419369339942932, 0.5150626301765442, 0.4923507571220398, 0.5099414587020874, 0.5020742416381836, 0.4798199534416199, 0.4596807360649109, 0.452108234167099, 0.43323054909706116, 0.4437861740589142, 0.42883339524269104, 0.43780386447906494, 0.4666708707809448, 0.4560626447200775, 0.4435080885887146, 0.42807331681251526, 0.47960057854652405, 0.42684972286224365, 0.4464944005012512, 0.4290817081928253, 0.4307750463485718, 0.4045177102088928, 0.4161358177661896]
gate_output_accuracy[7] = [0.806387722492218, 0.8746960759162903, 0.8868241310119629, 0.8932262063026428, 0.892204761505127, 0.8945689797401428, 0.8979594707489014, 0.8961755037307739, 0.899455726146698, 0.8996667265892029, 0.901608943939209, 0.9050665497779846, 0.9055748581886292, 0.905920147895813, 0.9084282517433167, 0.9076274037361145, 0.9119482040405273, 0.9131231307983398, 0.9115357995033264, 0.9128066301345825, 0.9130847454071045, 0.9162498712539673, 0.9134060740470886, 0.9225272536277771, 0.915803849697113, 0.9201774597167969]
val_gate_output_accuracy[7] = [0.8644604086875916, 0.9183241724967957, 0.9074904918670654, 0.9079983234405518, 0.9185442328453064, 0.9079813957214355, 0.9128734469413757, 0.9141938090324402, 0.9292932748794556, 0.9097080230712891, 0.9274312257766724, 0.9144815802574158, 0.9250105619430542, 0.9166821837425232, 0.9017689228057861, 0.9152771830558777, 0.9116546511650085, 0.929090142250061, 0.9166144728660583, 0.9296995401382446, 0.9279559850692749, 0.9172915816307068, 0.9301904439926147, 0.9309860467910767, 0.9355056881904602, 0.9249597787857056]
moe_output_mae[7] = [0.5286128520965576, 0.47720369696617126, 0.4598105251789093, 0.4477821886539459, 0.4450020492076874, 0.4376537501811981, 0.43151870369911194, 0.4310219883918762, 0.42770063877105713, 0.42670395970344543, 0.4234292805194855, 0.4222889244556427, 0.42010635137557983, 0.4179416000843048, 0.41758212447166443, 0.41479453444480896, 0.41443830728530884, 0.4125180244445801, 0.4120025932788849, 0.4110879600048065, 0.4088980257511139, 0.40703997015953064, 0.40798529982566833, 0.4083336591720581, 0.40450283885002136, 0.4006602466106415]
val_moe_output_mae[7] = [0.6732131242752075, 0.5455695390701294, 0.527082085609436, 0.5119533538818359, 0.5046268701553345, 0.4835536479949951, 0.4941234886646271, 0.49198001623153687, 0.4756399989128113, 0.46028563380241394, 0.45632660388946533, 0.4434502422809601, 0.44953012466430664, 0.4384476840496063, 0.44903016090393066, 0.4693697392940521, 0.46052250266075134, 0.4504499137401581, 0.43942496180534363, 0.47955045104026794, 0.43960675597190857, 0.44875848293304443, 0.4441872239112854, 0.4432290196418762, 0.4296496510505676, 0.43481379747390747]
# 74/74 [==============================] - 1s 7ms/step - loss: 2.0418 - gate_output_loss: 0.2064 - moe_output_loss: 0.4161 - gate_output_accuracy: 0.9250 - moe_output_mae: 0.4348
# no test dataset, generating
# ds: <BatchDataset shapes: (None, None, 148), types: tf.float32>
# type(ds): <class 'tensorflow.python.data.ops.dataset_ops.BatchDataset'>
# type(input_data): <class 'tensorflow.python.framework.ops.Tensor'>, shape: Tensor("Shape:0", shape=(3,), dtype=int32)
# type(experts_labels): <class 'tensorflow.python.framework.ops.Tensor'>, shape: Tensor("Shape_1:0", shape=(3,), dtype=int32)
# type(experts_labels): <class 'tensorflow.python.framework.ops.Tensor'>, shape: Tensor("Shape_2:0", shape=(3,), dtype=int32)
# ==============================
# ======== Test Metrics ========
# ==============================
# =========== MoE ===========
# loss                : 2.9134
# gate_output_loss    : 1.0676
# moe_output_loss     : 0.4683
# gate_output_accuracy: 0.7924
# moe_output_mae      : 0.4915
# ==============================
# Model is saved as: __untrack/models/RAL/2022-02-23_16:52:44/model_MoE.h5
# Model architecture is saved as: __untrack/models/RAL/2022-02-23_16:52:44/model_MoE.png


####################################
#################################### 9
####################################

# Epoch 00046: LearningRateScheduler reducing learning rate to 0.0003874204890000001.
# 261/261 [==============================] - 4s 16ms/step - loss: 1.1504 - gate_output_loss: 0.1768 - moe_output_loss: 0.3172 - gate_output_accuracy: 0.9391 - moe_output_mae: 0.3830 - val_loss: 1.3116 - val_gate_output_loss: 0.2229 - val_moe_output_loss: 0.4166 - val_gate_output_accuracy: 0.9176 - val_moe_output_mae: 0.4338
# [on_epoch_end] epoch: 45 , loss: 1.1709377765655518 , val_loss : 1.3116430044174194
# Epoch 00046: val_loss did not improve from 1.18187
loss[8] = [37.93720626831055, 4.731651782989502, 4.2688398361206055, 3.9533755779266357, 3.7470784187316895, 3.3904874324798584, 3.207735538482666, 3.1667094230651855, 3.1662425994873047, 2.9648776054382324, 2.8693432807922363, 2.707350492477417, 2.644212245941162, 2.599724292755127, 2.6518843173980713, 2.4444375038146973, 2.323753833770752, 2.2610251903533936, 2.3415563106536865, 2.290361166000366, 2.101270914077759, 2.0690903663635254, 2.0611250400543213, 2.0831470489501953, 1.963182806968689, 1.8169585466384888, 1.8375147581100464, 1.8029117584228516, 1.7357794046401978, 1.8195490837097168, 1.6317964792251587, 1.6482032537460327, 1.5467901229858398, 1.592603325843811, 1.5765128135681152, 1.4447717666625977, 1.455764889717102, 1.4330456256866455, 1.4473286867141724, 1.418268084526062, 1.2698358297348022, 1.2740395069122314, 1.2411772012710571, 1.2428486347198486, 1.316543698310852, 1.1709377765655518]
val_loss[8] = [4.758012294769287, 4.560477256774902, 3.6861424446105957, 3.666529655456543, 3.6513895988464355, 2.992820978164673, 3.049086332321167, 2.8303890228271484, 2.8432719707489014, 2.807415008544922, 2.6082236766815186, 2.8711981773376465, 2.721950054168701, 2.6967968940734863, 2.697655439376831, 2.340683698654175, 2.255688190460205, 2.4647269248962402, 2.376967668533325, 2.3768343925476074, 2.0621178150177, 2.105084180831909, 2.100898265838623, 2.0580999851226807, 2.081857919692993, 1.8298574686050415, 1.8306117057800293, 1.6940369606018066, 1.595367193222046, 1.9519013166427612, 1.6702417135238647, 1.522196650505066, 1.5402017831802368, 1.4257935285568237, 1.6088039875030518, 1.4033176898956299, 1.3102530241012573, 1.4780511856079102, 1.4593229293823242, 1.6055724620819092, 1.1832526922225952, 1.2553609609603882, 1.2449371814727783, 1.2286230325698853, 1.181872010231018, 1.3116430044174194]
gate_output_loss[8] = [0.6202414631843567, 0.38522040843963623, 0.3470720648765564, 0.33500784635543823, 0.31849539279937744, 0.30848076939582825, 0.2978840172290802, 0.2981225252151489, 0.29558470845222473, 0.28327658772468567, 0.29179731011390686, 0.27408260107040405, 0.27202364802360535, 0.26651260256767273, 0.2683878540992737, 0.26754504442214966, 0.24780668318271637, 0.2531256377696991, 0.25276070833206177, 0.24715259671211243, 0.2431054413318634, 0.23473908007144928, 0.23943957686424255, 0.2394346445798874, 0.2289019227027893, 0.22482430934906006, 0.23022176325321198, 0.22357666492462158, 0.2210914045572281, 0.22909975051879883, 0.2151065617799759, 0.212087020277977, 0.21242080628871918, 0.21084080636501312, 0.21384364366531372, 0.20797625184059143, 0.20494964718818665, 0.20526862144470215, 0.20652498304843903, 0.20401132106781006, 0.19259041547775269, 0.19865697622299194, 0.19000206887722015, 0.19070157408714294, 0.19469894468784332, 0.18487830460071564]
val_gate_output_loss[8] = [0.3504473865032196, 0.3151904046535492, 0.26581135392189026, 0.2514946460723877, 0.2670622169971466, 0.3103036880493164, 0.2421346753835678, 0.22114191949367523, 0.24224716424942017, 0.22601331770420074, 0.23035313189029694, 0.20942319929599762, 0.25154340267181396, 0.23214128613471985, 0.27869662642478943, 0.27182966470718384, 0.23072458803653717, 0.22913716733455658, 0.24403196573257446, 0.2408580780029297, 0.25670114159584045, 0.22079995274543762, 0.1969066858291626, 0.22571028769016266, 0.21469669044017792, 0.22013679146766663, 0.2630923390388489, 0.276917964220047, 0.21073593199253082, 0.20808221399784088, 0.2116299420595169, 0.22811245918273926, 0.22584056854248047, 0.19540075957775116, 0.2220463901758194, 0.2015330046415329, 0.21471048891544342, 0.24617475271224976, 0.22720196843147278, 0.2265809178352356, 0.18778018653392792, 0.21764503419399261, 0.21473276615142822, 0.2103937864303589, 0.20040415227413177, 0.22293318808078766]
moe_output_loss[8] = [0.5804556012153625, 0.4860455393791199, 0.4450052082538605, 0.42951902747154236, 0.42381441593170166, 0.40565600991249084, 0.40091952681541443, 0.3950011730194092, 0.39610111713409424, 0.38617146015167236, 0.39030149579048157, 0.38207128643989563, 0.37539955973625183, 0.3739226162433624, 0.37452664971351624, 0.3638763427734375, 0.36220264434814453, 0.3572385013103485, 0.3668944835662842, 0.3570229113101959, 0.3559863269329071, 0.35533642768859863, 0.3547384440898895, 0.3530915379524231, 0.3487534821033478, 0.3429127633571625, 0.35052892565727234, 0.3446219265460968, 0.34051331877708435, 0.3451840579509735, 0.33458417654037476, 0.3384931981563568, 0.3321988880634308, 0.33596986532211304, 0.3346220552921295, 0.3301488757133484, 0.33035632967948914, 0.33095306158065796, 0.32999420166015625, 0.329889714717865, 0.320282906293869, 0.3213040828704834, 0.3228429853916168, 0.32052960991859436, 0.32149142026901245, 0.3202968239784241]
val_moe_output_loss[8] = [0.8188011646270752, 0.59665447473526, 0.5081406235694885, 0.5150233507156372, 0.4905119836330414, 0.46148234605789185, 0.48427245020866394, 0.46810662746429443, 0.4833931624889374, 0.4788687229156494, 0.44098666310310364, 0.47452324628829956, 0.4679722785949707, 0.44305452704429626, 0.4540030360221863, 0.4507022798061371, 0.4333115220069885, 0.43705785274505615, 0.4217316210269928, 0.4309159815311432, 0.4204190671443939, 0.4230537712574005, 0.4123532176017761, 0.4288693368434906, 0.41449010372161865, 0.40935489535331726, 0.4223567843437195, 0.4185873866081238, 0.39836397767066956, 0.409014493227005, 0.4067458510398865, 0.41895410418510437, 0.40963584184646606, 0.40355944633483887, 0.4287767708301544, 0.4105127155780792, 0.39565664529800415, 0.4115069508552551, 0.4050884544849396, 0.4176171123981476, 0.3881058096885681, 0.4222913980484009, 0.38158443570137024, 0.39302676916122437, 0.391257107257843, 0.41661614179611206]
gate_output_accuracy[8] = [0.7980386018753052, 0.876791775226593, 0.8848627209663391, 0.8862438797950745, 0.8919170498847961, 0.894079864025116, 0.8959836959838867, 0.8974319696426392, 0.8973168730735779, 0.900409996509552, 0.8990528583526611, 0.9046732783317566, 0.9058146476745605, 0.9059345126152039, 0.9078575968742371, 0.9083275198936462, 0.9146481156349182, 0.9113103747367859, 0.9113775491714478, 0.9169260263442993, 0.9152235984802246, 0.919295072555542, 0.9171226620674133, 0.9163457751274109, 0.9198896884918213, 0.9225032925605774, 0.9182975888252258, 0.9226327538490295, 0.9244551062583923, 0.9216640591621399, 0.9237021803855896, 0.9263924956321716, 0.9266418814659119, 0.9283635020256042, 0.9250065684318542, 0.9270063638687134, 0.9279175400733948, 0.9275914430618286, 0.9297541975975037, 0.9291260242462158, 0.9338064789772034, 0.9308524131774902, 0.934832751750946, 0.9325260519981384, 0.9315957427024841, 0.9364104866981506]
val_gate_output_accuracy[8] = [0.8815234899520874, 0.88365638256073, 0.9104697704315186, 0.925958514213562, 0.8981803059577942, 0.9006855487823486, 0.914176881313324, 0.9274989366531372, 0.9121624827384949, 0.9200169444084167, 0.9224883913993835, 0.9226576089859009, 0.9118577837944031, 0.9217604994773865, 0.9124333262443542, 0.9079475402832031, 0.9284130334854126, 0.9206432700157166, 0.920677125453949, 0.9129073023796082, 0.9099619388580322, 0.9235547780990601, 0.9320186376571655, 0.9265679121017456, 0.9271773099899292, 0.921726644039154, 0.8997037410736084, 0.9035801887512207, 0.9263817071914673, 0.9309521913528442, 0.9296149015426636, 0.9194583296775818, 0.9282437562942505, 0.9309014081954956, 0.9224206805229187, 0.9358273148536682, 0.9159542918205261, 0.9085400104522705, 0.920355498790741, 0.9263986349105835, 0.934066891670227, 0.9241472482681274, 0.9256876707077026, 0.9313923120498657, 0.9267710447311401, 0.9176132082939148]
moe_output_mae[8] = [0.5308693647384644, 0.47880443930625916, 0.45879676938056946, 0.4496745765209198, 0.443787544965744, 0.4353065490722656, 0.43160301446914673, 0.4282456338405609, 0.427900493144989, 0.4234636127948761, 0.423189640045166, 0.4198337197303772, 0.4166276156902313, 0.4160879850387573, 0.4156714677810669, 0.4099865257740021, 0.40906864404678345, 0.40798091888427734, 0.4100736677646637, 0.40604859590530396, 0.4042457938194275, 0.40444570779800415, 0.4048425257205963, 0.40234339237213135, 0.4015957713127136, 0.39851924777030945, 0.4009944200515747, 0.39953985810279846, 0.3973444700241089, 0.39848488569259644, 0.3927595615386963, 0.3956572115421295, 0.39282166957855225, 0.3928993046283722, 0.39277195930480957, 0.39095303416252136, 0.39066118001937866, 0.3906450569629669, 0.3893812894821167, 0.38988202810287476, 0.3846534192562103, 0.38584402203559875, 0.38607099652290344, 0.3845074474811554, 0.3854193091392517, 0.38428995013237]
val_moe_output_mae[8] = [0.6762011051177979, 0.5577254891395569, 0.49250954389572144, 0.49982184171676636, 0.487852543592453, 0.46597886085510254, 0.4793929159641266, 0.47070521116256714, 0.47055405378341675, 0.477425217628479, 0.44718843698501587, 0.47436198592185974, 0.47100162506103516, 0.4493327736854553, 0.4575890004634857, 0.4550316631793976, 0.443684458732605, 0.4490213096141815, 0.4357531666755676, 0.441376268863678, 0.43757230043411255, 0.433551162481308, 0.4333145022392273, 0.4407517910003662, 0.4327884018421173, 0.4303304851055145, 0.4353685677051544, 0.4326778054237366, 0.4227293133735657, 0.4280987083911896, 0.4290623068809509, 0.4360685348510742, 0.4290393888950348, 0.4275398254394531, 0.44277483224868774, 0.43104109168052673, 0.42309167981147766, 0.43028655648231506, 0.42858269810676575, 0.43307411670684814, 0.4174644351005554, 0.43765366077423096, 0.4122737944126129, 0.42008113861083984, 0.4232187271118164, 0.4338383078575134]
# 74/74 [==============================] - 1s 7ms/step - loss: 1.3116 - gate_output_loss: 0.2229 - moe_output_loss: 0.4166 - gate_output_accuracy: 0.9176 - moe_output_mae: 0.4338
# no test dataset, generating
# ds: <BatchDataset shapes: (None, None, 148), types: tf.float32>
# type(ds): <class 'tensorflow.python.data.ops.dataset_ops.BatchDataset'>
# type(input_data): <class 'tensorflow.python.framework.ops.Tensor'>, shape: Tensor("Shape:0", shape=(3,), dtype=int32)
# type(experts_labels): <class 'tensorflow.python.framework.ops.Tensor'>, shape: Tensor("Shape_1:0", shape=(3,), dtype=int32)
# type(experts_labels): <class 'tensorflow.python.framework.ops.Tensor'>, shape: Tensor("Shape_2:0", shape=(3,), dtype=int32)
# ==============================
# ======== Test Metrics ========
# ==============================
# =========== MoE ===========
# loss                : 2.1283
# gate_output_loss    : 1.0281
# moe_output_loss     : 0.4739
# gate_output_accuracy: 0.7891
# moe_output_mae      : 0.4912
# ==============================
# Model is saved as: __untrack/models/RAL/2022-02-23_16:57:11/model_MoE.h5
# Model architecture is saved as: __untrack/models/RAL/2022-02-23_16:57:11/model_MoE.png

####################################
#################################### 10
####################################
#
# Epoch 00086: LearningRateScheduler reducing learning rate to 0.00016677181699666576.
# 261/261 [==============================] - 5s 17ms/step - loss: 0.6281 - gate_output_loss: 0.1422 - moe_output_loss: 0.2780 - gate_output_accuracy: 0.9491 - moe_output_mae: 0.3613 - val_loss: 0.7048 - val_gate_output_loss: 0.2291 - val_moe_output_loss: 0.3789 - val_gate_output_accuracy: 0.9213 - val_moe_output_mae: 0.4107
# [on_epoch_end] epoch: 85 , loss: 0.6053327918052673 , val_loss : 0.7048330903053284
# Epoch 00086: val_loss did not improve from 0.70012
loss[9] = [37.84657287597656, 4.775252342224121, 4.176816463470459, 4.027523994445801, 3.6488037109375, 3.3145227432250977, 3.297240734100342, 3.16988468170166, 3.0869948863983154, 3.004361391067505, 2.747326374053955, 2.9315340518951416, 2.748973846435547, 2.6481432914733887, 2.6526167392730713, 2.455291986465454, 2.352731466293335, 2.357297658920288, 2.293914318084717, 2.3286852836608887, 2.07956862449646, 2.080077886581421, 2.0357825756073, 2.057309627532959, 2.035604476928711, 1.847406029701233, 1.8815537691116333, 1.837471842765808, 1.7354400157928467, 1.8384901285171509, 1.6507917642593384, 1.666582465171814, 1.5871678590774536, 1.5689502954483032, 1.566938042640686, 1.494957447052002, 1.4626710414886475, 1.4544179439544678, 1.4847699403762817, 1.412077784538269, 1.3717801570892334, 1.3607860803604126, 1.2553834915161133, 1.288006067276001, 1.2882179021835327, 1.1710922718048096, 1.162866234779358, 1.135443925857544, 1.1702768802642822, 1.1657713651657104, 1.0372480154037476, 1.0741000175476074, 1.0487385988235474, 0.9929713606834412, 1.0341774225234985, 0.95741206407547, 0.9969877600669861, 0.9521732330322266, 0.9537898302078247, 0.9525326490402222, 0.8878971338272095, 0.9043745994567871, 0.8698087334632874, 0.8807775378227234, 0.8592990040779114, 0.8340997695922852, 0.79410719871521, 0.7901483178138733, 0.8019537329673767, 0.8037313222885132, 0.7443650960922241, 0.7370052337646484, 0.7157055139541626, 0.7758468985557556, 0.7497341632843018, 0.7064804434776306, 0.6661127805709839, 0.6643943190574646, 0.6683127284049988, 0.6779663562774658, 0.6337165236473083, 0.6211829781532288, 0.6399859189987183, 0.6331294178962708, 0.6325598955154419, 0.6053327918052673]
val_loss[9] = [4.703993797302246, 4.521327495574951, 4.321165084838867, 3.9789364337921143, 3.37626576423645, 3.6424334049224854, 3.235814332962036, 3.1758339405059814, 2.7959842681884766, 2.922605514526367, 3.090569496154785, 2.6690683364868164, 2.7705328464508057, 2.861768960952759, 2.5973153114318848, 2.3644795417785645, 2.4187204837799072, 2.51049542427063, 2.449622869491577, 2.1774682998657227, 2.232957363128662, 1.8932411670684814, 1.9258413314819336, 2.0419113636016846, 1.9922049045562744, 1.8393405675888062, 1.7874354124069214, 1.7671623229980469, 1.812230110168457, 1.7896209955215454, 1.6292465925216675, 1.5519884824752808, 1.5483750104904175, 1.5457783937454224, 1.6823137998580933, 1.5763882398605347, 1.4899097681045532, 1.4326568841934204, 1.3383034467697144, 1.3853520154953003, 1.320115327835083, 1.3551784753799438, 1.3330169916152954, 1.4157220125198364, 1.201206088066101, 1.1065114736557007, 1.1863977909088135, 1.1263355016708374, 1.1715351343154907, 1.2469587326049805, 1.0683152675628662, 1.2793290615081787, 1.0121656656265259, 1.1228581666946411, 1.0882889032363892, 1.0020185708999634, 1.0359647274017334, 1.0171327590942383, 0.987204372882843, 1.0396239757537842, 0.9257153272628784, 0.9403096437454224, 0.8603054881095886, 0.9181762337684631, 0.9074892997741699, 0.925199568271637, 0.8970469236373901, 0.8194504380226135, 0.8392672538757324, 0.9125933051109314, 0.7927126884460449, 0.8419304490089417, 0.7977871894836426, 0.8791703581809998, 0.8326742649078369, 0.7477638125419617, 0.7869454026222229, 0.8066723346710205, 0.7934363484382629, 0.784629762172699, 0.7019782662391663, 0.7001237869262695, 0.756502628326416, 0.7228761315345764, 0.7895742058753967, 0.7048330903053284]
gate_output_loss[9] = [0.6134593486785889, 0.3928471803665161, 0.33653953671455383, 0.3341900706291199, 0.31429803371429443, 0.3038316071033478, 0.3004579544067383, 0.30102741718292236, 0.29055628180503845, 0.2919089198112488, 0.2761152684688568, 0.28634458780288696, 0.2791023850440979, 0.26584357023239136, 0.2750745117664337, 0.2620966136455536, 0.2497321516275406, 0.2593154013156891, 0.24880270659923553, 0.24845638871192932, 0.23574787378311157, 0.2400965392589569, 0.23844915628433228, 0.23940691351890564, 0.22837930917739868, 0.23175427317619324, 0.22878828644752502, 0.2255571037530899, 0.21930311620235443, 0.2240486592054367, 0.21936702728271484, 0.21809418499469757, 0.21412767469882965, 0.2133897989988327, 0.21074290573596954, 0.20872612297534943, 0.20909760892391205, 0.20437827706336975, 0.2075721025466919, 0.20221421122550964, 0.2013154774904251, 0.20675812661647797, 0.19163593649864197, 0.19582389295101166, 0.1961096227169037, 0.18976671993732452, 0.18612715601921082, 0.18511752784252167, 0.18763640522956848, 0.19279496371746063, 0.17643952369689941, 0.182148739695549, 0.18163925409317017, 0.17544294893741608, 0.1796608716249466, 0.1726018637418747, 0.1756604015827179, 0.17093494534492493, 0.17298182845115662, 0.17393988370895386, 0.170138418674469, 0.17156071960926056, 0.1650301069021225, 0.16965831816196442, 0.16700556874275208, 0.16794665157794952, 0.1587093323469162, 0.15876536071300507, 0.16053830087184906, 0.15819697082042694, 0.1552550494670868, 0.1545938104391098, 0.15195375680923462, 0.1607406735420227, 0.1582648903131485, 0.15246044099330902, 0.14493189752101898, 0.14285293221473694, 0.1413290947675705, 0.148030087351799, 0.1423587203025818, 0.1410549283027649, 0.14702428877353668, 0.14588606357574463, 0.14431220293045044, 0.1398315578699112]
val_gate_output_loss[9] = [0.38542693853378296, 0.23117902874946594, 0.2709757089614868, 0.27416595816612244, 0.24310317635536194, 0.3171927034854889, 0.2558704614639282, 0.21717196702957153, 0.23954258859157562, 0.2592563331127167, 0.2617243230342865, 0.23088867962360382, 0.24954849481582642, 0.27058860659599304, 0.2408241182565689, 0.26261940598487854, 0.22801023721694946, 0.2031424641609192, 0.2750698924064636, 0.2433139830827713, 0.23046082258224487, 0.18535353243350983, 0.19387421011924744, 0.23736952245235443, 0.24119223654270172, 0.20971907675266266, 0.1888219118118286, 0.2395765483379364, 0.26674097776412964, 0.2002991884946823, 0.2212209552526474, 0.1989617943763733, 0.2658817768096924, 0.2198309600353241, 0.1883108764886856, 0.213458850979805, 0.24406349658966064, 0.22485093772411346, 0.2064538449048996, 0.21253758668899536, 0.22886066138744354, 0.18586555123329163, 0.2082553207874298, 0.24828119575977325, 0.18365556001663208, 0.20645815134048462, 0.18779969215393066, 0.20689372718334198, 0.20903372764587402, 0.21043328940868378, 0.1793983429670334, 0.22909289598464966, 0.20016644895076752, 0.2653733789920807, 0.2173321396112442, 0.2313976287841797, 0.21378681063652039, 0.23696699738502502, 0.1997314691543579, 0.22691549360752106, 0.2159896194934845, 0.19498072564601898, 0.20126141607761383, 0.23144546151161194, 0.22144964337348938, 0.23664329946041107, 0.22983422875404358, 0.20007045567035675, 0.19893676042556763, 0.18896041810512543, 0.24037423729896545, 0.21821333467960358, 0.21818561851978302, 0.22419460117816925, 0.24849152565002441, 0.19942981004714966, 0.22574186325073242, 0.2467188686132431, 0.24667412042617798, 0.24379625916481018, 0.20568688213825226, 0.21202313899993896, 0.22840693593025208, 0.23242680728435516, 0.21383504569530487, 0.22907961905002594]
moe_output_loss[9] = [0.5753219127655029, 0.4814225137233734, 0.44592776894569397, 0.4304916262626648, 0.4151584208011627, 0.40254324674606323, 0.3975932002067566, 0.3938058018684387, 0.3917577266693115, 0.38552185893058777, 0.3776034414768219, 0.37893450260162354, 0.38272425532341003, 0.3671778440475464, 0.36769527196884155, 0.3645883798599243, 0.3649885058403015, 0.3634309768676758, 0.3537691533565521, 0.35737311840057373, 0.3487575948238373, 0.3481569290161133, 0.34808349609375, 0.3474099338054657, 0.34711331129074097, 0.34146878123283386, 0.33664199709892273, 0.33933138847351074, 0.33633363246917725, 0.33624982833862305, 0.33336400985717773, 0.3296905755996704, 0.32957723736763, 0.3280610144138336, 0.3271583616733551, 0.3233892023563385, 0.3229512572288513, 0.3202318251132965, 0.32496604323387146, 0.31749433279037476, 0.3218019902706146, 0.3202642500400543, 0.3148958384990692, 0.31361255049705505, 0.3161396384239197, 0.307003915309906, 0.3115162253379822, 0.3082782030105591, 0.3082338571548462, 0.30836743116378784, 0.3026323914527893, 0.3044995963573456, 0.3048487901687622, 0.301608145236969, 0.30346083641052246, 0.2983928918838501, 0.29815909266471863, 0.30125194787979126, 0.3005865812301636, 0.29593345522880554, 0.296123206615448, 0.2971615493297577, 0.29662269353866577, 0.2947944402694702, 0.29623955488204956, 0.2931500971317291, 0.28912675380706787, 0.290069580078125, 0.2903202772140503, 0.29346662759780884, 0.28738102316856384, 0.2875344455242157, 0.2859382629394531, 0.2901693284511566, 0.28982898592948914, 0.28531453013420105, 0.28360965847969055, 0.2842816412448883, 0.28103888034820557, 0.2836964726448059, 0.28108927607536316, 0.28027328848838806, 0.27975425124168396, 0.2794255018234253, 0.27897027134895325, 0.27828270196914673]
val_moe_output_loss[9] = [0.8324170112609863, 0.6151474714279175, 0.5495526790618896, 0.5118127465248108, 0.48393428325653076, 0.5633767247200012, 0.460041880607605, 0.4591115117073059, 0.46491241455078125, 0.4849209189414978, 0.467643141746521, 0.48011407256126404, 0.42941680550575256, 0.4477095901966095, 0.449083149433136, 0.4288732409477234, 0.44065937399864197, 0.4419228434562683, 0.4465157985687256, 0.4401555359363556, 0.43476301431655884, 0.4217842221260071, 0.42862290143966675, 0.4447377920150757, 0.4258861839771271, 0.4098638892173767, 0.4355278015136719, 0.41346368193626404, 0.4027617871761322, 0.4162519574165344, 0.41851940751075745, 0.39404597878456116, 0.4066052734851837, 0.4080943465232849, 0.4254763722419739, 0.42820367217063904, 0.416921466588974, 0.40763768553733826, 0.3850139379501343, 0.3945537507534027, 0.3834623694419861, 0.3972201943397522, 0.3909732699394226, 0.39587274193763733, 0.3886058032512665, 0.3855606019496918, 0.392392635345459, 0.38650044798851013, 0.4027094542980194, 0.38775956630706787, 0.39790958166122437, 0.41342270374298096, 0.38859865069389343, 0.4076073467731476, 0.38933080434799194, 0.40876147150993347, 0.3992445468902588, 0.3923114836215973, 0.38035839796066284, 0.3899145722389221, 0.3787877857685089, 0.3843158185482025, 0.3756982982158661, 0.3929964005947113, 0.3816160261631012, 0.37945666909217834, 0.3746519684791565, 0.3806205689907074, 0.3794316053390503, 0.3867124021053314, 0.37646254897117615, 0.3866957426071167, 0.40035587549209595, 0.3772702217102051, 0.3749532997608185, 0.3752118945121765, 0.3826688230037689, 0.3709752857685089, 0.3923121988773346, 0.3767726719379425, 0.3694291412830353, 0.3794596791267395, 0.3671840727329254, 0.3745017945766449, 0.3831520080566406, 0.3789081871509552]
gate_output_accuracy[9] = [0.8021196722984314, 0.8731471300125122, 0.887226939201355, 0.8880853652954102, 0.8933029770851135, 0.8962522745132446, 0.8972641229629517, 0.895628809928894, 0.9001030921936035, 0.9003908634185791, 0.9051384925842285, 0.9037525653839111, 0.9031339287757874, 0.9093537926673889, 0.9049466252326965, 0.9101594686508179, 0.9142692685127258, 0.9093441963195801, 0.9133341312408447, 0.9138616323471069, 0.9189785122871399, 0.9172425270080566, 0.9182687997817993, 0.9158230423927307, 0.92111736536026, 0.9191943407058716, 0.9211797118186951, 0.9216784834861755, 0.9231027364730835, 0.919635534286499, 0.9235295653343201, 0.923409640789032, 0.925562858581543, 0.9257307052612305, 0.9261287450790405, 0.9261479377746582, 0.9264644384384155, 0.9290252923965454, 0.9274571537971497, 0.9304975271224976, 0.9291643500328064, 0.9272269606590271, 0.9306557774543762, 0.9289054274559021, 0.9307277202606201, 0.9338352680206299, 0.9356671571731567, 0.9346025586128235, 0.9345929622650146, 0.9312264919281006, 0.9395660161972046, 0.9352259635925293, 0.9353650808334351, 0.9383671283721924, 0.9366310834884644, 0.9393693804740906, 0.937993049621582, 0.9397434592247009, 0.9381656646728516, 0.9393118619918823, 0.940755307674408, 0.9397050738334656, 0.9422467350959778, 0.9386356472969055, 0.9414554834365845, 0.9408272504806519, 0.9428269863128662, 0.9434936046600342, 0.9429565072059631, 0.9442129135131836, 0.944927453994751, 0.9454789757728577, 0.9452152252197266, 0.9425153136253357, 0.9441553950309753, 0.9450089931488037, 0.9482939839363098, 0.9477232694625854, 0.949833333492279, 0.948624849319458, 0.9493442177772522, 0.950303316116333, 0.9475938081741333, 0.949099600315094, 0.9491236209869385, 0.9504759907722473]
val_gate_output_accuracy[9] = [0.8703681826591492, 0.9226745367050171, 0.9093525409698486, 0.9108759760856628, 0.9137367606163025, 0.8786288499832153, 0.9167329668998718, 0.9181379675865173, 0.9131950736045837, 0.9084384441375732, 0.9014642238616943, 0.9164790511131287, 0.9105713367462158, 0.9038171768188477, 0.918595016002655, 0.9042572975158691, 0.9249259233474731, 0.9315615892410278, 0.891104519367218, 0.9091324806213379, 0.9207279086112976, 0.9342700242996216, 0.9296995401382446, 0.9153956770896912, 0.9125179648399353, 0.9220144152641296, 0.9334574937820435, 0.9246042966842651, 0.9000422954559326, 0.9217604994773865, 0.9176132082939148, 0.9296318292617798, 0.9063732624053955, 0.9258230924606323, 0.9294794797897339, 0.9204232096672058, 0.9124671816825867, 0.9159204363822937, 0.9296149015426636, 0.9177486300468445, 0.9148709177970886, 0.9323910474777222, 0.9246889352798462, 0.9089970588684082, 0.9347439408302307, 0.9241811037063599, 0.932780385017395, 0.9269911050796509, 0.927718997001648, 0.9248243570327759, 0.9296149015426636, 0.9154464602470398, 0.9269741773605347, 0.9039695262908936, 0.9189504981040955, 0.9152433276176453, 0.923791766166687, 0.9124671816825867, 0.9289885759353638, 0.9199492335319519, 0.9188658595085144, 0.9276174306869507, 0.9267033338546753, 0.9151079058647156, 0.9226745367050171, 0.9175962805747986, 0.9198984503746033, 0.9266186952590942, 0.9263817071914673, 0.9330681562423706, 0.9146000742912292, 0.9246042966842651, 0.9214558005332947, 0.9188658595085144, 0.9075920581817627, 0.931256890296936, 0.9245027303695679, 0.9129242300987244, 0.914904773235321, 0.9154464602470398, 0.9223529696464539, 0.9246381521224976, 0.9218282103538513, 0.9172577261924744, 0.9282099008560181, 0.9212695956230164]
moe_output_mae[9] = [0.5292769074440002, 0.477962851524353, 0.45936962962150574, 0.4507907032966614, 0.4410475790500641, 0.4347451627254486, 0.4323886036872864, 0.4286024868488312, 0.42747801542282104, 0.42374157905578613, 0.4199654161930084, 0.4195159375667572, 0.42009711265563965, 0.41371282935142517, 0.4139270484447479, 0.41077423095703125, 0.41124770045280457, 0.41011470556259155, 0.40570735931396484, 0.40657928586006165, 0.4022970199584961, 0.4024104177951813, 0.40144017338752747, 0.4019714295864105, 0.400522381067276, 0.39633333683013916, 0.3961315453052521, 0.3969712555408478, 0.3946221172809601, 0.39487224817276, 0.39341336488723755, 0.3920249044895172, 0.39182430505752563, 0.3903341293334961, 0.38986316323280334, 0.3870235085487366, 0.3876243829727173, 0.38606274127960205, 0.3880120813846588, 0.383746474981308, 0.3854936361312866, 0.3855374753475189, 0.38316887617111206, 0.38215479254722595, 0.383385568857193, 0.3782101273536682, 0.3809302747249603, 0.3789648413658142, 0.3796101212501526, 0.3793894350528717, 0.3751448392868042, 0.37568774819374084, 0.37766847014427185, 0.37426096200942993, 0.37644368410110474, 0.37189561128616333, 0.3731140196323395, 0.37479692697525024, 0.37427014112472534, 0.37266165018081665, 0.3718098998069763, 0.3721746802330017, 0.37217673659324646, 0.37093016505241394, 0.3719307780265808, 0.3693866431713104, 0.36707228422164917, 0.3677810728549957, 0.36809059977531433, 0.36953625082969666, 0.3669363558292389, 0.3658761978149414, 0.3657742738723755, 0.3664885461330414, 0.3674831688404083, 0.36435529589653015, 0.36467382311820984, 0.36428695917129517, 0.3623778223991394, 0.3650361895561218, 0.3621426522731781, 0.3618226647377014, 0.3618270456790924, 0.36075958609580994, 0.361502468585968, 0.3609044551849365]
val_moe_output_mae[9] = [0.6831594109535217, 0.5652225017547607, 0.5218994617462158, 0.49753642082214355, 0.4771510064601898, 0.5237795114517212, 0.4635011851787567, 0.4657929241657257, 0.46767741441726685, 0.47602716088294983, 0.4630650281906128, 0.4820358455181122, 0.4446965157985687, 0.45420950651168823, 0.46071144938468933, 0.4456384479999542, 0.45880597829818726, 0.45939815044403076, 0.4553544223308563, 0.4529860317707062, 0.4490325152873993, 0.4385543167591095, 0.44786959886550903, 0.45347410440444946, 0.4428088665008545, 0.43178653717041016, 0.45170143246650696, 0.4357662796974182, 0.42565712332725525, 0.43694281578063965, 0.43676257133483887, 0.42485904693603516, 0.43027085065841675, 0.4299527108669281, 0.4431457221508026, 0.4436860978603363, 0.43752098083496094, 0.42970582842826843, 0.4171692430973053, 0.4234671890735626, 0.41521039605140686, 0.4237287640571594, 0.41762498021125793, 0.42096248269081116, 0.41674697399139404, 0.41466596722602844, 0.41849857568740845, 0.4159446060657501, 0.43116891384124756, 0.41855812072753906, 0.41979071497917175, 0.4382801055908203, 0.4182852506637573, 0.429364949464798, 0.4157778024673462, 0.4302274286746979, 0.4228004515171051, 0.4167673587799072, 0.41205501556396484, 0.4167507588863373, 0.4125128984451294, 0.4162580668926239, 0.4089963436126709, 0.4190419018268585, 0.4132843017578125, 0.4116136431694031, 0.406389057636261, 0.4081411361694336, 0.41095587611198425, 0.4154967963695526, 0.4093303680419922, 0.4149380028247833, 0.4225529432296753, 0.40861040353775024, 0.4065054655075073, 0.40602877736091614, 0.4114454388618469, 0.40410125255584717, 0.42218905687332153, 0.40677332878112793, 0.4050208628177643, 0.41297805309295654, 0.4020858407020569, 0.4074823558330536, 0.41370636224746704, 0.4107162356376648]
# 74/74 [==============================] - 1s 6ms/step - loss: 0.7048 - gate_output_loss: 0.2291 - moe_output_loss: 0.3789 - gate_output_accuracy: 0.9213 - moe_output_mae: 0.4107
# no test dataset, generating
# ds: <BatchDataset shapes: (None, None, 148), types: tf.float32>
# type(ds): <class 'tensorflow.python.data.ops.dataset_ops.BatchDataset'>
# type(input_data): <class 'tensorflow.python.framework.ops.Tensor'>, shape: Tensor("Shape:0", shape=(3,), dtype=int32)
# type(experts_labels): <class 'tensorflow.python.framework.ops.Tensor'>, shape: Tensor("Shape_1:0", shape=(3,), dtype=int32)
# type(experts_labels): <class 'tensorflow.python.framework.ops.Tensor'>, shape: Tensor("Shape_2:0", shape=(3,), dtype=int32)
# ==============================
# ======== Test Metrics ========
# ==============================
# =========== MoE ===========
# loss                : 1.8064
# gate_output_loss    : 1.3190
# moe_output_loss     : 0.4372
# gate_output_accuracy: 0.7502
# moe_output_mae      : 0.4741
# ==============================
# Model is saved as: __untrack/models/RAL/2022-02-23_17:04:50/model_MoE.h5
# Model architecture is saved as: __untrack/models/RAL/2022-02-23_17:04:50/model_MoE.png

# print(len(loss[0]))
min_length = 100
for i in range(len(loss)):
    if len(loss[i]) < min_length:
        min_length = len(loss[i])

print(min_length)


font_size = 16
alpha_val= 0.3
x_lim= 40

if __name__ == "__main__":

    loss = DataFrame(loss)
    val_loss = DataFrame(val_loss)

    gate_output_loss = DataFrame(gate_output_loss)
    val_gate_output_loss = DataFrame(val_gate_output_loss)

    moe_output_loss = DataFrame(moe_output_loss)
    val_moe_output_loss = DataFrame(val_moe_output_loss)

    gate_output_accuracy = DataFrame(gate_output_accuracy)
    val_gate_output_accuracy = DataFrame(val_gate_output_accuracy)

    moe_output_mae = DataFrame(moe_output_mae)
    val_moe_output_mae = DataFrame(val_moe_output_mae)

    mean_loss = loss.mean(axis=0)
    mean_val_loss = val_loss.mean(axis=0)
    mean_gate_output_loss = gate_output_loss.mean(axis=0)
    mean_val_gate_output_loss = val_gate_output_loss.mean(axis=0)
    mean_moe_output_loss = moe_output_loss.mean(axis=0)
    mean_val_moe_output_loss = val_moe_output_loss.mean(axis=0)
    mean_gate_output_accuracy = gate_output_accuracy.mean(axis=0)
    mean_val_gate_output_accuracy = val_gate_output_accuracy.mean(axis=0)
    mean_moe_output_mae = moe_output_mae.mean(axis=0)
    mean_val_moe_output_mae = val_moe_output_mae.mean(axis=0)

    std_loss = loss.std(axis=0)
    std_val_loss = val_loss.std(axis=0)
    std_gate_output_loss = gate_output_loss.std(axis=0)
    std_val_gate_output_loss = val_gate_output_loss.std(axis=0)
    std_moe_output_loss = moe_output_loss.std(axis=0)
    std_val_moe_output_loss = val_moe_output_loss.std(axis=0)
    std_gate_output_accuracy = gate_output_accuracy.std(axis=0)
    std_val_gate_output_accuracy = val_gate_output_accuracy.std(axis=0)
    std_moe_output_mae = moe_output_mae.std(axis=0)
    std_val_moe_output_mae = val_moe_output_mae.std(axis=0)

    epochs = range(len(mean_loss))

    # fig = plt.figure(figsize=(10, 7))
    # ax01 = fig.subplots()
    # ax01.grid(False)
    # ax01.set_xlabel("epoch", fontsize=font_size)
    # ax01.set_ylabel("loss", fontsize=font_size)

    # plt.plot(range(len(mean_loss)), mean_loss, 'k-')
    # plt.fill_between(range(len(mean_loss)), mean_loss - std_loss, mean_loss + std_loss, alpha=0.25)
    # plt.show()
    # ax01.set_ylim(1, 5)
    # ax01.set_xlim(0, 50)

    # plot 1: losses
    plot_loss = plt.figure(1, figsize=(6, 8))
    axs_loss = plot_loss.subplots(3)

    axs_loss[0].plot(epochs, mean_loss)
    axs_loss[0].fill_between(epochs, mean_loss-std_loss, mean_loss+std_loss, alpha=alpha_val)

    axs_loss[0].plot(epochs, mean_val_loss)
    axs_loss[0].fill_between(epochs, mean_val_loss-std_val_loss, mean_val_loss+std_val_loss, alpha=alpha_val)

    axs_loss[0].set_title('total loss', fontsize=font_size)
    axs_loss[0].legend(['train', 'validation'], loc='upper left', fontsize=font_size)
    axs_loss[0].set_ylim(0.0, 8.0)
    axs_loss[0].set_xlim(0, x_lim)

    axs_loss[1].plot(epochs, mean_gate_output_loss)
    axs_loss[1].fill_between(epochs, mean_gate_output_loss-std_gate_output_loss,
                             mean_gate_output_loss+std_gate_output_loss, alpha=alpha_val)

    axs_loss[1].plot(epochs, mean_val_gate_output_loss)
    axs_loss[1].fill_between(epochs, mean_val_gate_output_loss-std_val_gate_output_loss,
                             mean_val_gate_output_loss+std_val_gate_output_loss, alpha=alpha_val)

    axs_loss[1].set_title('gate loss', fontsize=font_size)
    axs_loss[1].legend(['train', 'validation'], loc='upper left', fontsize=font_size)
    axs_loss[1].set_xlim(0, x_lim)

    axs_loss[2].plot(epochs, mean_moe_output_loss)
    axs_loss[2].fill_between(epochs, mean_moe_output_loss-std_moe_output_loss,
                             mean_moe_output_loss+std_moe_output_loss, alpha=alpha_val)

    axs_loss[2].plot(epochs, mean_val_moe_output_loss)
    axs_loss[2].fill_between(epochs, mean_val_moe_output_loss-std_val_moe_output_loss,
                             mean_val_moe_output_loss+std_val_moe_output_loss, alpha=alpha_val)
    axs_loss[2].set_title('moe loss', fontsize=font_size)
    axs_loss[2].legend(['train', 'validation'], loc='upper left', fontsize=font_size)
    axs_loss[2].set_xlim(0, x_lim)

    for ax in axs_loss.flat:
        ax.set_xlabel('epoch', fontsize=font_size)
        ax.set_ylabel('loss', fontsize=font_size)

    # Hide x labels and tick labels for top plots and y ticks for right plots.
    for ax in axs_loss.flat:
        ax.label_outer()

    plt.show()
    plt.tight_layout()

    # plot 2: accuracy and mae
    plot_metrics = plt.figure(2, figsize=(6, 8))
    axs_metrics = plot_metrics.subplots(2)

    plt.figure(2, figsize=(12, 8))
    plot_metrics.clf()
    axs_metrics = plot_metrics.subplots(2)
    axs_metrics[0].plot(epochs, mean_gate_output_accuracy)
    axs_metrics[0].fill_between(epochs, mean_gate_output_accuracy - std_gate_output_accuracy,
                                mean_gate_output_accuracy + std_gate_output_accuracy, alpha=alpha_val)

    axs_metrics[0].plot(mean_val_gate_output_accuracy)
    axs_metrics[0].fill_between(epochs, mean_val_gate_output_accuracy - std_val_gate_output_accuracy,
                                mean_val_gate_output_accuracy + std_val_gate_output_accuracy, alpha=alpha_val)

    axs_metrics[0].set_title('model accuracy', fontsize=font_size)
    axs_metrics[0].set_ylabel('accuracy', fontsize=font_size)
    axs_metrics[0].legend(['train', 'validation'], loc='upper left', fontsize=font_size)
    axs_metrics[0].set_xlim(0, x_lim)

    axs_metrics[1].plot(mean_moe_output_mae)
    axs_metrics[1].fill_between(epochs, mean_moe_output_mae - std_moe_output_mae,
                                mean_moe_output_mae + std_moe_output_mae, alpha=alpha_val)

    axs_metrics[1].plot(mean_val_moe_output_mae)
    axs_metrics[1].fill_between(epochs, mean_val_moe_output_mae - std_val_moe_output_mae,
                                mean_val_moe_output_mae + std_val_moe_output_mae, alpha=alpha_val)

    axs_metrics[1].set_title('model mae', fontsize=font_size)
    axs_metrics[1].set_xlabel('epoch', fontsize=font_size)
    axs_metrics[1].set_ylabel('mae', fontsize=font_size)
    axs_metrics[1].legend(['train', 'validation'], loc='upper left', fontsize=font_size)
    axs_metrics[1].set_xlim(0, x_lim)

    for ax in axs_metrics.flat:
        ax.label_outer()

    plt.show()






